<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msapplication-config" content="/images/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideRightIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Here are some interesting tips when you are using Kotlin. Let’s take a look at something about object, invoke operator, and destructuring.">
<meta property="og:type" content="article">
<meta property="og:title" content="Kotlin tricks">
<meta property="og:url" content="http://yoursite.com/2019/11/23/Kotlin-tricks/index.html">
<meta property="og:site_name" content="舊金山周記">
<meta property="og:description" content="Here are some interesting tips when you are using Kotlin. Let’s take a look at something about object, invoke operator, and destructuring.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-11-24T05:16:00.000Z">
<meta property="article:modified_time" content="2020-04-12T07:50:09.355Z">
<meta property="article:author" content="Chauyan">
<meta property="article:tag" content="Kotlin">
<meta property="article:tag" content="Object">
<meta property="article:tag" content="Companion">
<meta property="article:tag" content="Destructuring">
<meta property="article:tag" content="Invoke">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2019/11/23/Kotlin-tricks/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Kotlin tricks | 舊金山周記</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149656006-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-149656006-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">舊金山周記</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The Venture of San Francisco</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags<span class="badge">102</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives<span class="badge">67</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/23/Kotlin-tricks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chauyan">
      <meta itemprop="description" content="Personal dev blog for sharing what I've learned.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="舊金山周記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kotlin tricks
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-23 21:16:00" itemprop="dateCreated datePublished" datetime="2019-11-23T21:16:00-08:00">2019-11-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-12 00:50:09" itemprop="dateModified" datetime="2020-04-12T00:50:09-07:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-Dev/" itemprop="url" rel="index"><span itemprop="name">Android Dev</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/11/23/Kotlin-tricks/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/11/23/Kotlin-tricks/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Here are some interesting tips when you are using Kotlin. Let’s take a look at something about <code>object,</code> <code>invoke operator,</code> and <code>destructuring.</code></p>
<span id="more"></span>

<h4 id="object-trick"><a href="#object-trick" class="headerlink" title="object trick"></a>object trick</h4><p>The keyword <code>object</code> has many different functions in the Kotlin. One of its functionality is to create a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton instance</a>.  </p>
<pre><code class="highlight java">object DataProviderManager &#123;
  fun <span class="title function_">registerDataProvider</span><span class="params">(provider: DataProvider)</span> &#123;
    <span class="comment">// ...</span>
  &#125;

  val allDataProviders: Collection&lt;DataProvider&gt;
    <span class="title function_">get</span><span class="params">()</span> = <span class="comment">// ...</span>
&#125;</code></pre>

<p>Except the singleton object, you can use <code>object</code> to instantiate an anonoymous class intance, for example: </p>
<pre><code class="highlight java">layout.setOnTouchListener(object : View.OnTouchListener &#123;
  override fun <span class="title function_">onTouch</span><span class="params">(v: View, m: MotionEvent)</span>: Boolean &#123;
    <span class="comment">// Perform tasks here</span>
    <span class="keyword">return</span> <span class="literal">true</span>
  &#125;
&#125;)</code></pre>

<p>What about a companion? You know there’s no <code>static</code> keyword in Kotlin world. So we have another weapon <code>companion</code> to do also the same thing. And, there’s one drawback for <code>object</code> class which is that you are not able to send a parameter to this singleton class, how can we leverage <code>companion</code> and <code>object</code> to do this?</p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">SomeData</span>(
  val aString: String
)

<span class="keyword">class</span> <span class="title class_">SomeClass</span> &#123;
  companion object &#123;
    <span class="keyword">protected</span> lateinit <span class="keyword">var</span> inClassData: SomeData
    fun <span class="title function_">getInstance</span><span class="params">(initData: SomeData)</span>: SomeClass &#123;
      inClassData = initData
      <span class="keyword">return</span> SomeClass()
    &#125;
  &#125;

  fun <span class="title function_">doSomething</span><span class="params">()</span>: SomeData &#123;
    println(<span class="string">&quot;my data : &quot;</span> + inClassData.aString)
    
    <span class="comment">// put your calculation logic here</span>
    <span class="keyword">return</span> inClassData
  &#125;
&#125;</code></pre>

<p>So, you can easily pass in a <code>SomeData</code> data class into this singleton instance.</p>
<pre><code class="highlight java"><span class="type">val</span> <span class="variable">myData</span> <span class="operator">=</span> SomeData(<span class="string">&quot;data&quot;</span>)
<span class="type">val</span> <span class="variable">singleton</span> <span class="operator">=</span> SomeClass.getInstance(myData)
singleton.doSomething()</code></pre>

<p>Can we do furthermore by using this concept? Yes, it gives us the ability to separate the operation logic from a refactoring class. And, it would be convenient for developers if they are refactoring their project at a particular stage.</p>
<p><strong>Note that even though the members of companion objects look like static members in other languages, but they are instance members of real objects at runtime which means they can implement interfaces</strong>:</p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">SomeData</span>()

<span class="keyword">interface</span> <span class="title class_">Operations</span>&lt;T&gt; &#123;
  fun <span class="title function_">print</span><span class="params">(initData: SomeData)</span>: T
&#125;

<span class="keyword">class</span> <span class="title class_">SomeClass</span> &#123;
  companion object: Operations&lt;SomeClass&gt; &#123;
    <span class="keyword">protected</span> lateinit <span class="keyword">var</span> inClassData: SomeData
    override fun <span class="title function_">print</span><span class="params">(initData: SomeData)</span>: SomeClass &#123;
      inClassData = initData
      <span class="keyword">return</span> SomeClass()
    &#125;
  &#125;

  fun <span class="title function_">doSomething</span><span class="params">()</span>: SomeData &#123;
    println(<span class="string">&quot;my data : &quot;</span> + inClassData.aString)
    <span class="comment">// put your calculation logic here</span>
    <span class="keyword">return</span> inClassData
  &#125;
&#125;</code></pre>

<p>So, you can separate some logic from the class to an interface, that would make your code more clear. Here is another useful example to show how can we change the behavior of a singleton instance:</p>
<p><strong>VehicleManager</strong></p>
<pre><code class="highlight java">object VehicleManager &#123;
  fun <span class="title function_">vehicleStatus</span><span class="params">()</span>: String = <span class="string">&quot;driving&quot;</span>
&#125;

fun <span class="title function_">start</span><span class="params">(manager: VehicleManager)</span> &#123;
  println(<span class="string">&quot;Current status : &quot;</span> + manager.vehicleStatus())
&#125;</code></pre>

<p>If you try to print out the vehicle’s status, do this: </p>
<pre><code class="highlight java">start(VehicleManager)</code></pre>

<p>Let’s not use the <code>object</code> to create a singleton instance and give the App more flexibility by using the interface:</p>
<p><strong>VehicleManager Interface</strong></p>
<pre><code class="highlight java"><span class="keyword">interface</span> <span class="title class_">VehicleManager</span> &#123;
  companion object: VehicleManager &#123;
    override fun <span class="title function_">vehicleStatus</span><span class="params">()</span>: String = <span class="string">&quot;driving&quot;</span>
  &#125;
  fun <span class="title function_">vehicleStatus</span><span class="params">()</span>: String
&#125;

fun <span class="title function_">start</span><span class="params">(manager: VehicleManager)</span> &#123;
  println(<span class="string">&quot;Current status : &quot;</span> + manager.vehicleStatus())
&#125;</code></pre>

<p>You need to change to this way to use it: </p>
<pre><code class="highlight java">start(VehicleManager.Companion)</code></pre>

<p>By using this way, it would be easier for the developer who is refactoring the <code>VehicleManager</code> or can create another class inherited from <code>VehicleManager</code> and has more operations.</p>
<h4 id="Invoke-operator"><a href="#Invoke-operator" class="headerlink" title="Invoke operator"></a>Invoke operator</h4><p>Let’s see an example first.</p>
<pre><code class="highlight java"><span class="keyword">class</span> <span class="title class_">Result</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Socket</span> &#123;
  <span class="keyword">abstract</span> fun <span class="title function_">openURL</span><span class="params">(url: String)</span>: Result
&#125;

<span class="keyword">class</span> <span class="title class_">SocketImpl</span>: Socket() &#123;
  override fun <span class="title function_">openURL</span><span class="params">(url: String)</span>: Result &#123;
    <span class="keyword">return</span> Result()
  &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">URLHandler</span> (socket: Socket) &#123;

  val socket: Socket = socket
  operator fun <span class="title function_">invoke</span><span class="params">(url: String)</span>: Result &#123;
    println(<span class="string">&quot;launch socket to open URL&quot;</span>)
    <span class="keyword">return</span> <span class="built_in">this</span>.socket.openURL(url)
  &#125;
&#125;</code></pre>

<p>We create a URLHandler to process a specific URL that would use a <code>Socket</code> class to open the URL we passed in. In the <code>URLHandler</code> class, we implement the <code>invoke</code> operator function, which is unique in the Kotlin world. Let’s see what’s the tricky part here. </p>
<pre><code class="highlight java"><span class="type">val</span> <span class="variable">urlHandler</span> <span class="operator">=</span> URLHandler(SocketImpl())
urlHandler(<span class="string">&quot;www.google.com&quot;</span>)</code></pre>

<p>If you implement the <code>invoke</code> operator function, you can directly use the class instance to open the passed in URL string without any function call, which means it would automatically be invoked. It’s just like this instance to be a function.</p>
<pre><code class="highlight bash">30712-30712/idv.chauyan.androidcoroutine I/System.out: launch socket to open URL</code></pre>

<p>Where can we find this in Kotlin? In Kotlin, you can see this:<a href="https://github.com/JetBrains/kotlin/blob/d3156c33be09fae459df1247476a401605ae92ae/libraries/stdlib/jvm/runtime/kotlin/jvm/functions/Functions.kt">Function Interfaces</a></p>
<p>So, when you try to use the lambda function, which is defined by these interfaces, we can directly use the lambda function. </p>
<pre><code class="highlight java"><span class="type">val</span> <span class="variable">lambda</span> <span class="operator">=</span> &#123;name: String -&gt; <span class="string">&quot;Hello, &quot;</span>.plus(name)&#125;
println(lambda(<span class="string">&quot;chauyan&quot;</span>))</code></pre>

<p>The result would be <code>Hello, chauyan.</code></p>
<h4 id="Destructuring"><a href="#Destructuring" class="headerlink" title="Destructuring"></a>Destructuring</h4><p>Kotlin supports the <code>Destructuring</code> feature, let’s see what’s <code>Destructuring</code> and what pro and con it has.</p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">Person</span> (
  val id: Int,
  val name: String, 
  val age: Int
)

fun <span class="title function_">main</span><span class="params">(args: Array)</span> &#123;
  <span class="type">val</span> <span class="variable">person</span> <span class="operator">=</span> Person(<span class="number">1</span>, <span class="string">&quot;test person&quot;</span>, <span class="number">40</span>)
  println(<span class="string">&quot;Name of Person: &quot;</span> + person.name);
&#125;</code></pre>

<p>We have a data class <code>Person</code> which has three member variables - <code>id,</code> <code>name,</code> and <code>age.</code> In general, if we want to access the member variables of a class, we usually use this way: <code>person.id,</code> <code>person.name,</code> etc. We can use <code>destructuring</code> to benefit us and write less code: </p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">Person</span>(
  ...
)

fun <span class="title function_">main</span><span class="params">(args: Array)</span> &#123;
  <span class="type">val</span> <span class="variable">person</span> <span class="operator">=</span> Person(<span class="number">1</span>, <span class="string">&quot;test person&quot;</span>, <span class="number">40</span>)
  val (_, name, age) = person
  <span class="title function_">println</span><span class="params">(<span class="string">&quot;Name of Person: &quot;</span> + name)</span>
&#125;</code></pre>

<p>It’s more intuitive, and you can easily understand what you get from this data class - <code>Person.</code> What else can we do by using <code>destructuring</code>?</p>
<p><strong>Destructuring the return value of a function</strong></p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">Result</span>(val error: Error, val result: Int)

fun <span class="title function_">function</span><span class="params">(...)</span>: Result &#123;
  ...  
  <span class="keyword">return</span> Result(error, result)
&#125;

val (error, result) = function(...)</code></pre>

<p>We can directly get the computed result from this function without assigning a variable to it. If we want to check the result quickly, we can ignore the error (not good habit, just for example) like this:</p>
<pre><code class="highlight java">val (_, result) = function(...)</code></pre>

<p><strong>Destructuring in a for-loop</strong></p>
<pre><code class="highlight java"><span class="keyword">for</span> ((key, value) in map) &#123;
 <span class="comment">// do something with the key and the value</span>
&#125;</code></pre>

<p>It’s more clear if we try to access something in a collection. Also, if you use lambda functions in your project, especially RxJava, you might change to use in this way:</p>
<p><strong>Destructuring in a lambda function</strong></p>
<pre><code class="highlight java"><span class="comment">// normal usage</span>
map.mapValues &#123; entry -&gt; <span class="string">&quot;$&#123;entry.value&#125;!&quot;</span> &#125;

<span class="comment">// with destructuring way</span>
map.mapValues &#123; (key, value) -&gt; <span class="string">&quot;$value!&quot;</span> &#125;</code></pre>

<p><strong>Limitations of the destructuring</strong></p>
<p>When you are using the destructuring feature, you need to handle the variable types carefully. If you change the data class fields (no matter increasing or decreasing), you also need to update your <code>destructuring</code> declaration. In our example, <code>Person</code> data class, we add another field called occupation above the <code>age</code> as a string type.</p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">Person</span> (
  val id: Int,
  val name: String, 
  val occupation: String,
  val age: Int
)</code></pre>

<p>If we don’t change the previous code in the main function, you will get the wrong value:</p>
<pre><code class="highlight java">fun <span class="title function_">main</span><span class="params">(args: Array)</span> &#123;
  <span class="type">val</span> <span class="variable">person</span> <span class="operator">=</span> Person(<span class="number">1</span>, <span class="string">&quot;test person&quot;</span>, <span class="string">&quot;engineer&quot;</span>, <span class="number">40</span>)
  val (_, name, age) = person

  <span class="title function_">println</span><span class="params">(<span class="string">&quot;name : &quot;</span> + name)</span>;
  println(<span class="string">&quot;age : &quot;</span> + age);
&#125;</code></pre>

<p>What is your expectation of the value of age? It should be 40, but it will print out the value - <code>engineer.</code> That’s the reason why if we want to change to the field, then we need to update the destructuring declaration as well. And, do we have any way to avoid this? Yes, we do. </p>
<pre><code class="highlight java">val (_, name: String, age: Int) = person</code></pre>

<p>Explicitly declare what kind of type you want, and let the compiler to help you. </p>
<pre><code class="highlight java"><span class="string">&#x27;component3()&#x27;</span> function returns <span class="string">&#x27;String&#x27;</span>, but <span class="string">&#x27;Int&#x27;</span> is expected</code></pre>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Kotlin/" rel="tag"># Kotlin</a>
              <a href="/tags/Object/" rel="tag"># Object</a>
              <a href="/tags/Companion/" rel="tag"># Companion</a>
              <a href="/tags/Destructuring/" rel="tag"># Destructuring</a>
              <a href="/tags/Invoke/" rel="tag"># Invoke</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/10/12/Cron-Job-on-TypeScript/" rel="prev" title="Cron Job on TypeScript">
      <i class="fa fa-chevron-left"></i> Cron Job on TypeScript
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/11/28/Continuous-Integration-Issue-Tracking-system-Git-settings/" rel="next" title="Github CI setting plus issue tracking system on YouTrack">
      Github CI setting plus issue tracking system on YouTrack <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/23/Kotlin-tricks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chauyan">
      <meta itemprop="description" content="Personal dev blog for sharing what I've learned.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="舊金山周記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kotlin tricks
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-23 21:16:00" itemprop="dateCreated datePublished" datetime="2019-11-23T21:16:00-08:00">2019-11-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-12 00:50:09" itemprop="dateModified" datetime="2020-04-12T00:50:09-07:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-Dev/" itemprop="url" rel="index"><span itemprop="name">Android Dev</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/11/23/Kotlin-tricks/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/11/23/Kotlin-tricks/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Here are some interesting tips when you are using Kotlin. Let’s take a look at something about <code>object,</code> <code>invoke operator,</code> and <code>destructuring.</code></p>
<span id="more"></span>

<h4 id="object-trick"><a href="#object-trick" class="headerlink" title="object trick"></a>object trick</h4><p>The keyword <code>object</code> has many different functions in the Kotlin. One of its functionality is to create a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton instance</a>.  </p>
<pre><code class="highlight java">object DataProviderManager &#123;
  fun <span class="title function_">registerDataProvider</span><span class="params">(provider: DataProvider)</span> &#123;
    <span class="comment">// ...</span>
  &#125;

  val allDataProviders: Collection&lt;DataProvider&gt;
    <span class="title function_">get</span><span class="params">()</span> = <span class="comment">// ...</span>
&#125;</code></pre>

<p>Except the singleton object, you can use <code>object</code> to instantiate an anonoymous class intance, for example: </p>
<pre><code class="highlight java">layout.setOnTouchListener(object : View.OnTouchListener &#123;
  override fun <span class="title function_">onTouch</span><span class="params">(v: View, m: MotionEvent)</span>: Boolean &#123;
    <span class="comment">// Perform tasks here</span>
    <span class="keyword">return</span> <span class="literal">true</span>
  &#125;
&#125;)</code></pre>

<p>What about a companion? You know there’s no <code>static</code> keyword in Kotlin world. So we have another weapon <code>companion</code> to do also the same thing. And, there’s one drawback for <code>object</code> class which is that you are not able to send a parameter to this singleton class, how can we leverage <code>companion</code> and <code>object</code> to do this?</p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">SomeData</span>(
  val aString: String
)

<span class="keyword">class</span> <span class="title class_">SomeClass</span> &#123;
  companion object &#123;
    <span class="keyword">protected</span> lateinit <span class="keyword">var</span> inClassData: SomeData
    fun <span class="title function_">getInstance</span><span class="params">(initData: SomeData)</span>: SomeClass &#123;
      inClassData = initData
      <span class="keyword">return</span> SomeClass()
    &#125;
  &#125;

  fun <span class="title function_">doSomething</span><span class="params">()</span>: SomeData &#123;
    println(<span class="string">&quot;my data : &quot;</span> + inClassData.aString)
    
    <span class="comment">// put your calculation logic here</span>
    <span class="keyword">return</span> inClassData
  &#125;
&#125;</code></pre>

<p>So, you can easily pass in a <code>SomeData</code> data class into this singleton instance.</p>
<pre><code class="highlight java"><span class="type">val</span> <span class="variable">myData</span> <span class="operator">=</span> SomeData(<span class="string">&quot;data&quot;</span>)
<span class="type">val</span> <span class="variable">singleton</span> <span class="operator">=</span> SomeClass.getInstance(myData)
singleton.doSomething()</code></pre>

<p>Can we do furthermore by using this concept? Yes, it gives us the ability to separate the operation logic from a refactoring class. And, it would be convenient for developers if they are refactoring their project at a particular stage.</p>
<p><strong>Note that even though the members of companion objects look like static members in other languages, but they are instance members of real objects at runtime which means they can implement interfaces</strong>:</p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">SomeData</span>()

<span class="keyword">interface</span> <span class="title class_">Operations</span>&lt;T&gt; &#123;
  fun <span class="title function_">print</span><span class="params">(initData: SomeData)</span>: T
&#125;

<span class="keyword">class</span> <span class="title class_">SomeClass</span> &#123;
  companion object: Operations&lt;SomeClass&gt; &#123;
    <span class="keyword">protected</span> lateinit <span class="keyword">var</span> inClassData: SomeData
    override fun <span class="title function_">print</span><span class="params">(initData: SomeData)</span>: SomeClass &#123;
      inClassData = initData
      <span class="keyword">return</span> SomeClass()
    &#125;
  &#125;

  fun <span class="title function_">doSomething</span><span class="params">()</span>: SomeData &#123;
    println(<span class="string">&quot;my data : &quot;</span> + inClassData.aString)
    <span class="comment">// put your calculation logic here</span>
    <span class="keyword">return</span> inClassData
  &#125;
&#125;</code></pre>

<p>So, you can separate some logic from the class to an interface, that would make your code more clear. Here is another useful example to show how can we change the behavior of a singleton instance:</p>
<p><strong>VehicleManager</strong></p>
<pre><code class="highlight java">object VehicleManager &#123;
  fun <span class="title function_">vehicleStatus</span><span class="params">()</span>: String = <span class="string">&quot;driving&quot;</span>
&#125;

fun <span class="title function_">start</span><span class="params">(manager: VehicleManager)</span> &#123;
  println(<span class="string">&quot;Current status : &quot;</span> + manager.vehicleStatus())
&#125;</code></pre>

<p>If you try to print out the vehicle’s status, do this: </p>
<pre><code class="highlight java">start(VehicleManager)</code></pre>

<p>Let’s not use the <code>object</code> to create a singleton instance and give the App more flexibility by using the interface:</p>
<p><strong>VehicleManager Interface</strong></p>
<pre><code class="highlight java"><span class="keyword">interface</span> <span class="title class_">VehicleManager</span> &#123;
  companion object: VehicleManager &#123;
    override fun <span class="title function_">vehicleStatus</span><span class="params">()</span>: String = <span class="string">&quot;driving&quot;</span>
  &#125;
  fun <span class="title function_">vehicleStatus</span><span class="params">()</span>: String
&#125;

fun <span class="title function_">start</span><span class="params">(manager: VehicleManager)</span> &#123;
  println(<span class="string">&quot;Current status : &quot;</span> + manager.vehicleStatus())
&#125;</code></pre>

<p>You need to change to this way to use it: </p>
<pre><code class="highlight java">start(VehicleManager.Companion)</code></pre>

<p>By using this way, it would be easier for the developer who is refactoring the <code>VehicleManager</code> or can create another class inherited from <code>VehicleManager</code> and has more operations.</p>
<h4 id="Invoke-operator"><a href="#Invoke-operator" class="headerlink" title="Invoke operator"></a>Invoke operator</h4><p>Let’s see an example first.</p>
<pre><code class="highlight java"><span class="keyword">class</span> <span class="title class_">Result</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Socket</span> &#123;
  <span class="keyword">abstract</span> fun <span class="title function_">openURL</span><span class="params">(url: String)</span>: Result
&#125;

<span class="keyword">class</span> <span class="title class_">SocketImpl</span>: Socket() &#123;
  override fun <span class="title function_">openURL</span><span class="params">(url: String)</span>: Result &#123;
    <span class="keyword">return</span> Result()
  &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">URLHandler</span> (socket: Socket) &#123;

  val socket: Socket = socket
  operator fun <span class="title function_">invoke</span><span class="params">(url: String)</span>: Result &#123;
    println(<span class="string">&quot;launch socket to open URL&quot;</span>)
    <span class="keyword">return</span> <span class="built_in">this</span>.socket.openURL(url)
  &#125;
&#125;</code></pre>

<p>We create a URLHandler to process a specific URL that would use a <code>Socket</code> class to open the URL we passed in. In the <code>URLHandler</code> class, we implement the <code>invoke</code> operator function, which is unique in the Kotlin world. Let’s see what’s the tricky part here. </p>
<pre><code class="highlight java"><span class="type">val</span> <span class="variable">urlHandler</span> <span class="operator">=</span> URLHandler(SocketImpl())
urlHandler(<span class="string">&quot;www.google.com&quot;</span>)</code></pre>

<p>If you implement the <code>invoke</code> operator function, you can directly use the class instance to open the passed in URL string without any function call, which means it would automatically be invoked. It’s just like this instance to be a function.</p>
<pre><code class="highlight bash">30712-30712/idv.chauyan.androidcoroutine I/System.out: launch socket to open URL</code></pre>

<p>Where can we find this in Kotlin? In Kotlin, you can see this:<a href="https://github.com/JetBrains/kotlin/blob/d3156c33be09fae459df1247476a401605ae92ae/libraries/stdlib/jvm/runtime/kotlin/jvm/functions/Functions.kt">Function Interfaces</a></p>
<p>So, when you try to use the lambda function, which is defined by these interfaces, we can directly use the lambda function. </p>
<pre><code class="highlight java"><span class="type">val</span> <span class="variable">lambda</span> <span class="operator">=</span> &#123;name: String -&gt; <span class="string">&quot;Hello, &quot;</span>.plus(name)&#125;
println(lambda(<span class="string">&quot;chauyan&quot;</span>))</code></pre>

<p>The result would be <code>Hello, chauyan.</code></p>
<h4 id="Destructuring"><a href="#Destructuring" class="headerlink" title="Destructuring"></a>Destructuring</h4><p>Kotlin supports the <code>Destructuring</code> feature, let’s see what’s <code>Destructuring</code> and what pro and con it has.</p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">Person</span> (
  val id: Int,
  val name: String, 
  val age: Int
)

fun <span class="title function_">main</span><span class="params">(args: Array)</span> &#123;
  <span class="type">val</span> <span class="variable">person</span> <span class="operator">=</span> Person(<span class="number">1</span>, <span class="string">&quot;test person&quot;</span>, <span class="number">40</span>)
  println(<span class="string">&quot;Name of Person: &quot;</span> + person.name);
&#125;</code></pre>

<p>We have a data class <code>Person</code> which has three member variables - <code>id,</code> <code>name,</code> and <code>age.</code> In general, if we want to access the member variables of a class, we usually use this way: <code>person.id,</code> <code>person.name,</code> etc. We can use <code>destructuring</code> to benefit us and write less code: </p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">Person</span>(
  ...
)

fun <span class="title function_">main</span><span class="params">(args: Array)</span> &#123;
  <span class="type">val</span> <span class="variable">person</span> <span class="operator">=</span> Person(<span class="number">1</span>, <span class="string">&quot;test person&quot;</span>, <span class="number">40</span>)
  val (_, name, age) = person
  <span class="title function_">println</span><span class="params">(<span class="string">&quot;Name of Person: &quot;</span> + name)</span>
&#125;</code></pre>

<p>It’s more intuitive, and you can easily understand what you get from this data class - <code>Person.</code> What else can we do by using <code>destructuring</code>?</p>
<p><strong>Destructuring the return value of a function</strong></p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">Result</span>(val error: Error, val result: Int)

fun <span class="title function_">function</span><span class="params">(...)</span>: Result &#123;
  ...  
  <span class="keyword">return</span> Result(error, result)
&#125;

val (error, result) = function(...)</code></pre>

<p>We can directly get the computed result from this function without assigning a variable to it. If we want to check the result quickly, we can ignore the error (not good habit, just for example) like this:</p>
<pre><code class="highlight java">val (_, result) = function(...)</code></pre>

<p><strong>Destructuring in a for-loop</strong></p>
<pre><code class="highlight java"><span class="keyword">for</span> ((key, value) in map) &#123;
 <span class="comment">// do something with the key and the value</span>
&#125;</code></pre>

<p>It’s more clear if we try to access something in a collection. Also, if you use lambda functions in your project, especially RxJava, you might change to use in this way:</p>
<p><strong>Destructuring in a lambda function</strong></p>
<pre><code class="highlight java"><span class="comment">// normal usage</span>
map.mapValues &#123; entry -&gt; <span class="string">&quot;$&#123;entry.value&#125;!&quot;</span> &#125;

<span class="comment">// with destructuring way</span>
map.mapValues &#123; (key, value) -&gt; <span class="string">&quot;$value!&quot;</span> &#125;</code></pre>

<p><strong>Limitations of the destructuring</strong></p>
<p>When you are using the destructuring feature, you need to handle the variable types carefully. If you change the data class fields (no matter increasing or decreasing), you also need to update your <code>destructuring</code> declaration. In our example, <code>Person</code> data class, we add another field called occupation above the <code>age</code> as a string type.</p>
<pre><code class="highlight java">data <span class="keyword">class</span> <span class="title class_">Person</span> (
  val id: Int,
  val name: String, 
  val occupation: String,
  val age: Int
)</code></pre>

<p>If we don’t change the previous code in the main function, you will get the wrong value:</p>
<pre><code class="highlight java">fun <span class="title function_">main</span><span class="params">(args: Array)</span> &#123;
  <span class="type">val</span> <span class="variable">person</span> <span class="operator">=</span> Person(<span class="number">1</span>, <span class="string">&quot;test person&quot;</span>, <span class="string">&quot;engineer&quot;</span>, <span class="number">40</span>)
  val (_, name, age) = person

  <span class="title function_">println</span><span class="params">(<span class="string">&quot;name : &quot;</span> + name)</span>;
  println(<span class="string">&quot;age : &quot;</span> + age);
&#125;</code></pre>

<p>What is your expectation of the value of age? It should be 40, but it will print out the value - <code>engineer.</code> That’s the reason why if we want to change to the field, then we need to update the destructuring declaration as well. And, do we have any way to avoid this? Yes, we do. </p>
<pre><code class="highlight java">val (_, name: String, age: Int) = person</code></pre>

<p>Explicitly declare what kind of type you want, and let the compiler to help you. </p>
<pre><code class="highlight java"><span class="string">&#x27;component3()&#x27;</span> function returns <span class="string">&#x27;String&#x27;</span>, but <span class="string">&#x27;Int&#x27;</span> is expected</code></pre>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Kotlin/" rel="tag"># Kotlin</a>
              <a href="/tags/Object/" rel="tag"># Object</a>
              <a href="/tags/Companion/" rel="tag"># Companion</a>
              <a href="/tags/Destructuring/" rel="tag"># Destructuring</a>
              <a href="/tags/Invoke/" rel="tag"># Invoke</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/10/12/Cron-Job-on-TypeScript/" rel="prev" title="Cron Job on TypeScript">
      <i class="fa fa-chevron-left"></i> Cron Job on TypeScript
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/11/28/Continuous-Integration-Issue-Tracking-system-Git-settings/" rel="next" title="Github CI setting plus issue tracking system on YouTrack">
      Github CI setting plus issue tracking system on YouTrack <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>
  <div>
  <script type="text/javascript">
	atOptions = {
		'key' : '335b6d5fd0ce419dba15708955862700',
		'format' : 'iframe',
		'height' : 60,
		'width' : 468,
		'params' : {}
	};
	document.write('<scr' + 'ipt type="text/javascript" src="http' + (location.protocol === 'https:' ? 's' : '') + '://www.madcpms.com/335b6d5fd0ce419dba15708955862700/invoke.js"></scr' + 'ipt>');
</script>
  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#object-trick"><span class="nav-number">1.</span> <span class="nav-text">object trick</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Invoke-operator"><span class="nav-number">2.</span> <span class="nav-text">Invoke operator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Destructuring"><span class="nav-number">3.</span> <span class="nav-text">Destructuring</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chauyan</p>
  <div class="site-description" itemprop="description">Personal dev blog for sharing what I've learned.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangchauyan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangchauyan" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wang.chauyan@gmail.com" title="E-Mail → mailto:wang.chauyan@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/deathrid" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;deathrid" rel="noopener" target="_blank"><i class="twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/chauyanw/" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;chauyanw&#x2F;" rel="noopener" target="_blank"><i class="facebook fa-fw"></i>FB Page</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chauyan</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://chauyan.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://yoursite.com/2019/11/23/Kotlin-tricks/";
    this.page.identifier = "2019/11/23/Kotlin-tricks/";
    this.page.title = "Kotlin tricks";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://chauyan.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCqTNIS0PZUFVzFmQOCcFEheWocG9daymY",
    authDomain: "personaldevblog.firebaseapp.com",
    databaseURL: "https://personaldevblog.firebaseio.com",
    projectId: "personaldevblog",
    storageBucket: "personaldevblog.appspot.com",
    messagingSenderId: "785621246959",
    appId: "1:785621246959:web:87cab80109fd2701f44c1a",
    measurementId: "G-4KWYT0P8Z8"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>
</body>
</html>
