<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msapplication-config" content="/images/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideRightIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="StoryI recently encountered an issue that I need to separate the App module (Android project) into several library modules to fulfill the requirements of the Dynamic Feature Module in the future. In">
<meta name="keywords" content="Dagger2">
<meta property="og:type" content="article">
<meta property="og:title" content="Dagger Series: How do you use it in your Modularization?">
<meta property="og:url" content="http://yoursite.com/2019/12/07/Dagger-Series-How-do-you-use-it-in-your-Modularization/index.html">
<meta property="og:site_name" content="舊金山周記">
<meta property="og:description" content="StoryI recently encountered an issue that I need to separate the App module (Android project) into several library modules to fulfill the requirements of the Dynamic Feature Module in the future. In">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://chauyanw.files.wordpress.com/2019/07/dependency-injection-modularized-android-application-1.jpg?w=2924">
<meta property="og:image" content="https://chauyanw.files.wordpress.com/2019/07/wait-its-hard.gif">
<meta property="og:image" content="https://miro.medium.com/max/960/1*pPdeVsUU7F4o4tCeHqxgoA.gif">
<meta property="og:image" content="https://miro.medium.com/max/1220/1*N29K_i5_14LAYG2TtP77aQ.jpeg">
<meta property="og:updated_time" content="2020-04-12T07:47:44.700Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dagger Series: How do you use it in your Modularization?">
<meta name="twitter:description" content="StoryI recently encountered an issue that I need to separate the App module (Android project) into several library modules to fulfill the requirements of the Dynamic Feature Module in the future. In">
<meta name="twitter:image" content="https://chauyanw.files.wordpress.com/2019/07/dependency-injection-modularized-android-application-1.jpg?w=2924">

<link rel="canonical" href="http://yoursite.com/2019/12/07/Dagger-Series-How-do-you-use-it-in-your-Modularization/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Dagger Series: How do you use it in your Modularization? | 舊金山周記</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149656006-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-149656006-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">舊金山周記</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">The Venture of San Francisco</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">98</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">57</span></a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/07/Dagger-Series-How-do-you-use-it-in-your-Modularization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chauyan">
      <meta itemprop="description" content="Personal dev blog for sharing what I've learned.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="舊金山周記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Dagger Series: How do you use it in your Modularization?
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-07 16:55:43" itemprop="dateCreated datePublished" datetime="2019-12-07T16:55:43-08:00">2019-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-12 00:47:44" itemprop="dateModified" datetime="2020-04-12T00:47:44-07:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-Dev/" itemprop="url" rel="index">
                    <span itemprop="name">Android Dev</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/07/Dagger-Series-How-do-you-use-it-in-your-Modularization/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/07/Dagger-Series-How-do-you-use-it-in-your-Modularization/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="https://chauyanw.files.wordpress.com/2019/07/dependency-injection-modularized-android-application-1.jpg?w=2924" alt="dependency-injection-modularized-android-application-1.jpg?w=2924"></p>
<h4 id="Story"><a href="#Story" class="headerlink" title="Story"></a>Story</h4><p>I recently encountered an issue that I need to separate the App module (Android project) into several library modules to fulfill the requirements of the <code>Dynamic Feature Module</code> in the future. In the beginning, I thought that should be an easy job, how hard it can be?</p>
<p><img src="https://chauyanw.files.wordpress.com/2019/07/wait-its-hard.gif" alt="wait-its-hard.gif"><br><em>How hard it can be?</em></p>
<a id="more"></a>


<p>We need to move files to different library modules and solve the import path errors, change the implementation path in <code>build.gradle</code> file for different library modules. Then, it’s done easy.</p>
<p>So easy huh?</p>
<p><img src="https://miro.medium.com/max/960/1*pPdeVsUU7F4o4tCeHqxgoA.gif" alt="1*pPdeVsUU7F4o4tCeHqxgoA.gif"><br><em>Too young too dumb</em></p>
<p>Unfortunately, if we need to use some 3rd-party libraries like <code>Dagger</code> to help us, the DI graph would be straightforward if we only have one <code>App Module.</code> If we only have one module, then we only need to create one component for this <code>App Module.</code> Once you move files to different library modules or dynamic feature modules (DFMs), there are two main problems you need to solve in this case:</p>
<ol>
<li>How do you create different components to let different modules provide resources for consumers?</li>
<li>How do you offer different data for an injected object in a module at runtime?</li>
</ol>
<p>I think the first issue would be much easier to solve. You have several weapons for this issue. In Dagger2, you can use either <code>Component Dependency</code> or <code>Subcomponent</code> to solve it.</p>
<p>What’s the difference between these two ways? Let’s see the scenario first.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> car: Car</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">drivingToOffice</span><span class="params">()</span></span> &#123;</span><br><span class="line">    car.go()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> car: Car</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">drivingToSchool</span><span class="params">()</span></span> &#123;</span><br><span class="line">    car.go()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We have two classes <code>Father</code> and <code>Son,</code> and these two classes have the same injected object <code>Car</code> because <code>Father</code> owns the car and <code>Son</code> can borrow this car from his father. What the components look like if we use <code>Dependency</code>?</p>
<h4 id="Dependency-Way-for-Dagger-Components"><a href="#Dependency-Way-for-Dagger-Components" class="headerlink" title="Dependency Way for Dagger Components"></a>Dependency Way for Dagger Components</h4><p>In the <code>FatherComponent,</code> we need to give it a customized scope, <code>FatherScope,</code> to differentiate from the <code>SonComponent.</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FatherScope</span></span><br><span class="line"><span class="meta">@Component(</span></span><br><span class="line"><span class="meta">  modules = [</span></span><br><span class="line"><span class="meta">    AndroidInjectionModule::class,</span></span><br><span class="line"><span class="meta">    CarModule::class</span></span><br><span class="line"><span class="meta">  ]</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">FatherComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Component</span>.Builder</span><br><span class="line">  <span class="class"><span class="keyword">interface</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">    <span class="meta">@BindsInstance</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">application</span><span class="params">(application: <span class="type">FatherApplication</span>)</span></span>: Builder</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">build</span><span class="params">()</span></span>: FatherComponent</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// provide car instance for son access </span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">getCar</span><span class="params">()</span></span>: Car</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the <code>SonComponent</code>:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SonScope</span></span><br><span class="line"><span class="meta">@Component(</span></span><br><span class="line"><span class="meta">  dependencies = [</span></span><br><span class="line"><span class="meta">    FatherComponent::class</span></span><br><span class="line"><span class="meta">  ],</span></span><br><span class="line"><span class="meta">  modules = [</span></span><br><span class="line"><span class="meta">    // modules for son component </span></span><br><span class="line"><span class="meta">  ]</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SonComponent</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can see the<code>SonComponent</code> sets up a component dependency by including the <code>FatherComponent</code>; and <code>FatherComponent</code> exposes his car from <code>CarModule</code> via the function <code>getCar()</code>. By using component dependency, all classes which inject into <code>SonComponent</code> can use any resources exposed from <code>FatherComponent.</code></p>
<p>But, there are two things you need to know about <code>Component Dependency</code> first:</p>
<ul>
<li><p><em>You need to use different <code>Scope</code> for various components, cause they have different life cycles.</em></p>
</li>
<li><p><em>Child components can only use exposed resources from parent components.</em></p>
</li>
</ul>
<h4 id="SubComponent-Way-for-Dagger-Components"><a href="#SubComponent-Way-for-Dagger-Components" class="headerlink" title="SubComponent Way for Dagger Components"></a>SubComponent Way for Dagger Components</h4><p>What about the <code>Subcomponent</code> way? Let’s see the code example first.</p>
<p><strong>FatherComponent</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module(</span></span><br><span class="line"><span class="meta">  subcomponents = [</span></span><br><span class="line"><span class="meta">    SonComponent::class</span></span><br><span class="line"><span class="meta">  ]</span></span><br><span class="line"><span class="meta">)</span> </span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CarModule</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FatherScope</span></span><br><span class="line"><span class="meta">@Component(</span></span><br><span class="line"><span class="meta">  modules = [</span></span><br><span class="line"><span class="meta">    AndroidInjectionModule::class,</span></span><br><span class="line"><span class="meta">    CarModule::class</span></span><br><span class="line"><span class="meta">  ]</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">FatherComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Component</span>.Builder</span><br><span class="line">  <span class="class"><span class="keyword">interface</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">    <span class="meta">@BindsInstance</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">application</span><span class="params">(application: <span class="type">FatherApplication</span>)</span></span>: Builder</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">build</span><span class="params">()</span></span>: FatherComponent</span><br><span class="line">  &#125;</span><br><span class="line">  sonComponent(): SonComponent.Builder</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SonComponent</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SonScope</span></span><br><span class="line"><span class="meta">@Component(</span></span><br><span class="line"><span class="meta">  modules = [</span></span><br><span class="line"><span class="meta">    // modules for son component </span></span><br><span class="line"><span class="meta">  ]</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SonComponent</span> </span>&#123; </span><br><span class="line"><span class="meta">@Component</span>.Builder</span><br><span class="line">  <span class="meta">@Subcomponent</span>.Builder</span><br><span class="line">  <span class="class"><span class="keyword">interface</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">build</span><span class="params">()</span></span>: SonComponent</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There’re a few changes in these two components. First, you need to create a builder for <code>SonComponent</code> as well,  which’s purpose is to create a <code>SonComponent</code> instance. And in the <code>FatherComponent</code>, we need to do two things:</p>
<ol>
<li><em>Let modules in <code>FatherComponent</code> know who the child component is. You will need to add the <code>subcomponents</code> keyword.</em></li>
<li><em>Declare the <code>SonComponent</code> builder here to create your own <code>SonComponent.</code></em></li>
</ol>
<p>The way you use it would be like this:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> fatherComponent = DaggerFaComponent.builder()</span><br><span class="line">  .application(<span class="keyword">this</span>)</span><br><span class="line">  .build()</span><br><span class="line"><span class="keyword">val</span> sonComponent = fatherComponent.sonComponent.build()</span><br></pre></td></tr></table></figure>

<p>The example shows how we are going to solve the first question. Now, it’s time to go on the second question, how do we change module provides dynamically? Let’s use a configuration data class to solve this.</p>
<h4 id="Dynamically-change-the-content-for-the-injected-object"><a href="#Dynamically-change-the-content-for-the-injected-object" class="headerlink" title="Dynamically change the content for the injected object"></a>Dynamically change the content for the injected object</h4><p>What’s the purpose of using the different content for an injected object at runtime? The possible use cases are running different environments when you are testing, especially when you have several debug modules with various base URLs running on different test servers for the <code>Retrofit</code> library. You would agree that creating different Retrofit instances is tedious. Let’s do only one Retrofit instance and apply for different base URLs.</p>
<p>First, create your own <code>Configuration</code> data class:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Configuration</span> </span>(mode: Mode) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Mode</span> </span>&#123;</span><br><span class="line">    Mode_1, Mode_2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> currentMode = Mode.Mode_1</span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span> &#123;</span><br><span class="line">    currentMode = mode</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s a pure configuration class, and we use it to know what current mode is. So, how can we use it?</p>
<p><img src="https://miro.medium.com/max/1220/1*N29K_i5_14LAYG2TtP77aQ.jpeg" alt="1*N29K_i5_14LAYG2TtP77aQ.jpeg"><br><em>Inject it</em></p>
<p>Let’s use it as a resource provider in components.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicatonModule</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Binds</span></span><br><span class="line">  <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">bindApplicationContext</span><span class="params">(application: <span class="type">BaseApplication</span>)</span></span>: Context</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Module</span></span><br><span class="line">  <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideConfiguration</span><span class="params">()</span></span>: Configuration = Configuration(Configuration.currentMode.Mode_1)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can directly put it into the application-level module and provide it to the entire App when launching the App. Now you can inject this <code>Configuration</code> into where you want to use in this App. How do we give different URLs based on different mode when we are using Retrofit? In your module, you need to do something like this:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In one of your modules:</span></span><br><span class="line"><span class="meta">@JvmStatic</span></span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">provideHttpClient</span><span class="params">(config: <span class="type">Configuration</span>)</span></span>: OkHttpClient &#123;</span><br><span class="line">  <span class="keyword">return</span> ServiceFactory.getHttpClient(</span><br><span class="line">    BuildConfig.DEBUG, userAgent,</span><br><span class="line">    <span class="keyword">when</span> (config.currentMode) &#123;</span><br><span class="line">      Configuration.Mode.Mode_1 -&gt; <span class="string">"server url 1"</span></span><br><span class="line">      Configuration.Mode.Mode_2 -&gt; <span class="string">"server url 2"</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can create only one <code>Retrofit</code> with an <code>OkHttpClient.</code> Then, according to our configuration setting, we give it different URLs. Let me dive a little bit deeper into it. We can use <code>Interceptor</code> to change the URL we want to use based on the <code>currentMode</code> value in the <code>Configuration</code> class.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Provide Okhttp client</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getHttpClient</span><span class="params">(debugMode: <span class="type">Boolean</span>, userAgent: <span class="type">String</span>, url: <span class="type">String</span>?)</span></span>: OkHttpClient &#123;</span><br><span class="line">  <span class="keyword">return</span> OkHttpClient.Builder()</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * for dynamically changing the url</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    .addInterceptor(URLInterceptor(url))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>URLInterceptor</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">URLInterceptor</span> </span>(<span class="keyword">private</span> <span class="keyword">val</span> url: String?): Interceptor &#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">intercept</span><span class="params">(chain: <span class="type">Interceptor</span>.<span class="type">Chain</span>)</span></span>: Response &#123;</span><br><span class="line">    <span class="keyword">val</span> request = chain.request()</span><br><span class="line"></span><br><span class="line">    url?.let&#123;</span><br><span class="line">      <span class="keyword">return</span> chain.proceed(request</span><br><span class="line">                  .newBuilder()</span><br><span class="line">                  .url(url)</span><br><span class="line">                  .build())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> chain.proceed(request)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here we replace the old URL with a new one. Now we are all set. Let’s see how to use it:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span>: <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> config: Configuration</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="keyword">super</span>.onCreate() </span><br><span class="line">    <span class="comment">// change here if you want</span></span><br><span class="line">    config.currentMode = Configuration.Mode.Mode_2 </span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And now, we can dynamically change the runtime object content via this configuration object. Happy coding, enjoy.</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Dagger2/" rel="tag"># Dagger2</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/01/Generic-Programming-in-Golang/" rel="prev" title="Generic Programming in Golang">
      <i class="fa fa-chevron-left"></i> Generic Programming in Golang
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/12/11/Dagger-Series-elegantly-handle-your-Activities-and-Fragments-by-AndroidInjector/" rel="next" title="Dagger Series: Elegantly handle your Activities and Fragments by AndroidInjector">
      Dagger Series: Elegantly handle your Activities and Fragments by AndroidInjector <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>
  <div>
  <script type="text/javascript">
	atOptions = {
		'key' : '335b6d5fd0ce419dba15708955862700',
		'format' : 'iframe',
		'height' : 60,
		'width' : 468,
		'params' : {}
	};
	document.write('<scr' + 'ipt type="text/javascript" src="http' + (location.protocol === 'https:' ? 's' : '') + '://www.madcpms.com/335b6d5fd0ce419dba15708955862700/invoke.js"></scr' + 'ipt>');
</script>
  </div>


          </div>
          
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Story"><span class="nav-number">1.</span> <span class="nav-text">Story</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dependency-Way-for-Dagger-Components"><span class="nav-number">2.</span> <span class="nav-text">Dependency Way for Dagger Components</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SubComponent-Way-for-Dagger-Components"><span class="nav-number">3.</span> <span class="nav-text">SubComponent Way for Dagger Components</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dynamically-change-the-content-for-the-injected-object"><span class="nav-number">4.</span> <span class="nav-text">Dynamically change the content for the injected object</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chauyan</p>
  <div class="site-description" itemprop="description">Personal dev blog for sharing what I've learned.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">98</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangchauyan" title="GitHub → https://github.com/wangchauyan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wang.chauyan@gmail.com" title="E-Mail → mailto:wang.chauyan@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/deathrid" title="Twitter → https://twitter.com/deathrid" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/chauyanw/" title="FB Page → https://www.facebook.com/chauyanw/" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i>FB Page</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chauyan</span>
</div>

        








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://chauyan.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "http://yoursite.com/2019/12/07/Dagger-Series-How-do-you-use-it-in-your-Modularization/",
            identifier: "2019/12/07/Dagger-Series-How-do-you-use-it-in-your-Modularization/",
            title: "Dagger Series: How do you use it in your Modularization?"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://chauyan.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    window.addEventListener('load', loadComments, false);
</script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCqTNIS0PZUFVzFmQOCcFEheWocG9daymY",
    authDomain: "personaldevblog.firebaseapp.com",
    databaseURL: "https://personaldevblog.firebaseio.com",
    projectId: "personaldevblog",
    storageBucket: "personaldevblog.appspot.com",
    messagingSenderId: "785621246959",
    appId: "1:785621246959:web:87cab80109fd2701f44c1a",
    measurementId: "G-4KWYT0P8Z8"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>
</body>
</html>
