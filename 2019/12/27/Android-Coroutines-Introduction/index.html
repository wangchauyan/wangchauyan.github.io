<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msapplication-config" content="/images/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideRightIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="I recently read the source code of Coroutines. It’s pretty fun, and I’ve learned a lot from the source code. I am going to share some I learned here. I would break the learning into several parts. I">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Coroutines - Introduction">
<meta property="og:url" content="http://yoursite.com/2019/12/27/Android-Coroutines-Introduction/index.html">
<meta property="og:site_name" content="舊金山周記">
<meta property="og:description" content="I recently read the source code of Coroutines. It’s pretty fun, and I’ve learned a lot from the source code. I am going to share some I learned here. I would break the learning into several parts. I">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://chauyanw.files.wordpress.com/2019/08/kotlin-coroutines-1.png?w=2924">
<meta property="article:published_time" content="2019-12-28T01:51:42.000Z">
<meta property="article:modified_time" content="2020-04-12T07:44:37.849Z">
<meta property="article:author" content="Chauyan">
<meta property="article:tag" content="Coroutines">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chauyanw.files.wordpress.com/2019/08/kotlin-coroutines-1.png?w=2924">

<link rel="canonical" href="http://yoursite.com/2019/12/27/Android-Coroutines-Introduction/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Android Coroutines - Introduction | 舊金山周記</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149656006-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-149656006-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">舊金山周記</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The Venture of San Francisco</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags<span class="badge">102</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives<span class="badge">67</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/27/Android-Coroutines-Introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chauyan">
      <meta itemprop="description" content="Personal dev blog for sharing what I've learned.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="舊金山周記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android Coroutines - Introduction
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-27 17:51:42" itemprop="dateCreated datePublished" datetime="2019-12-27T17:51:42-08:00">2019-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-12 00:44:37" itemprop="dateModified" datetime="2020-04-12T00:44:37-07:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-Dev/" itemprop="url" rel="index"><span itemprop="name">Android Dev</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/27/Android-Coroutines-Introduction/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/27/Android-Coroutines-Introduction/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="https://chauyanw.files.wordpress.com/2019/08/kotlin-coroutines-1.png?w=2924" alt="kotlin-coroutines-1.png?w=2924"></p>
<p>I recently read the source code of <code>Coroutines.</code> It’s pretty fun, and I’ve learned a lot from the source code. I am going to share some I learned here. I would break the learning into several parts. I hope everyone can find something useful for your projects.</p>
<span id="more"></span>

<p>I download the latest master branch code at <a href="https://github.com/Kotlin/kotlinx.coroutines"><strong>HERE</strong></a>, and if you are interested, you can just download the official release version to try. So, it’s up to you to choose either the official release version or the latest master branch. And the Kotlin version is <code>1.3.61</code> check <a href="https://github.com/Kotlin/kotlinx.coroutines/blob/master/README.md">README</a> here.</p>
<h4 id="Part1-Introduction"><a href="#Part1-Introduction" class="headerlink" title="Part1 - Introduction"></a>Part1 - Introduction</h4><p>Before starting the introduction, let’s think of a question: how do you handle the CPU-consuming tasks or networking accessing works? We can’t do these tasks in the main thread (in Android, which is UIThread). Then we need to think about using the multiple threading techniques to solve our questions. In Java, you can use <code>Thread</code> to do this.</p>
<pre><code class="highlight java"><span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;
  <span class="type">String</span> <span class="variable">threadName</span> <span class="operator">=</span> Thread.currentThread().getName();
  System.out.println(<span class="string">&quot;Hello &quot;</span> + threadName);
&#125;;

<span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);
thread.start();

System.out.println(<span class="string">&quot;Done!&quot;</span>);</code></pre>

<p>You can see the result:</p>
<pre><code class="highlight bash">Hello Thread-0
Done!</code></pre>

<p>or</p>
<pre><code class="highlight bash">Done!
Hello Thread-0</code></pre>

<p>But creating threads frequently is a resource-consuming behavior, you would want to create a <code>ThreadPool</code> to reduce the cost.</p>
<p>In Android, we have several options for concurrency tasks. For example, you can use the <code>AsyncTask,</code> <code>Background Service,</code> and <code>Handler</code> in the Android projects.</p>
<p>The second question is: how do you communicate between two different threads? In Java, you need to manipulate the <code>Thread</code> interaction by using <code>IPC</code> mechanism, for example, shared memory, Pipe, named Pipe, mapped memory, semaphore, socket, message, and signals. There are many techniques we can use. What about concurrency in Kotlin’s world? Do we have any weapons for arming? Fortunately, we can still use the same techniques from the Java world. But Kotlin gives us a more powerful weapon, Coroutines, to use.</p>
<p>Let’s see an example first. We have three functions which need the results from the previous one finished the job.</p>
<pre><code class="highlight kotlin"><span class="function"><span class="keyword">fun</span> <span class="title">requestToken</span><span class="params">()</span></span>: Token &#123; ... &#125;
<span class="function"><span class="keyword">fun</span> <span class="title">createPost</span><span class="params">(token: <span class="type">Token</span>, item: <span class="type">Item</span>)</span></span>: Post &#123; ... &#125;
<span class="function"><span class="keyword">fun</span> <span class="title">processPost</span><span class="params">(post: <span class="type">Post</span>)</span></span> &#123; ... &#125;

<span class="comment">// post a specific item</span>
<span class="function"><span class="keyword">fun</span> <span class="title">postItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;
  <span class="keyword">val</span> token = requestToken()
  <span class="keyword">val</span> post = createPost(token, item)
  processPost(post)
&#125;</code></pre>

<p>These three functions are probably time-consuming tasks. Hence, it’s not able to put them in the UI thread in the Android project. What can we do now?</p>
<h5 id="By-using-a-Thread"><a href="#By-using-a-Thread" class="headerlink" title="By using a Thread"></a>By using a Thread</h5><p>As I mentioned before, create a thread to run it.</p>
<pre><code class="highlight kotlin">Thread(&#123;
  postItem(item)
&#125;).start()</code></pre>

<p>Keeping this in mind: thread is not cheap. You would need to do context-switch, which is costly.</p>
<h5 id="By-using-a-Callback"><a href="#By-using-a-Callback" class="headerlink" title="By using a Callback"></a>By using a Callback</h5><p>We can also use a callback function plus threading to catch the result from each function.</p>
<pre><code class="highlight kotlin"><span class="function"><span class="keyword">fun</span> <span class="title">postItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;
  preparePostAsync &#123; token -&gt;
    submitPostAsync(token, item) &#123; post -&gt;
      processPost(post)
    &#125;
  &#125;
&#125;

<span class="function"><span class="keyword">fun</span> <span class="title">preparePostAsync</span><span class="params">(callback: (<span class="type">Token</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;
  <span class="comment">// make request and return immediately</span>
  <span class="comment">// arrange callback to be invoked later</span>
&#125;</code></pre>

<p>What’s the drawback of using callback? The most known pitfall is the <code>callback hell.</code> That makes you hardly debug and read the source code.</p>
<h5 id="By-using-Java-Future"><a href="#By-using-Java-Future" class="headerlink" title="By using Java Future"></a>By using Java <code>Future</code></h5><p>In Java 8, it introduces the <code>CompletableFuture.</code> This feature lets you connect several tasks.</p>
<pre><code class="highlight java">fun <span class="title function_">requestToken</span><span class="params">()</span>: CompletableFuture &#123; ... &#125;
fun <span class="title function_">createPost</span><span class="params">(token: Token, item: Item)</span>: CompletableFuture &#123; ... &#125;
fun <span class="title function_">processPost</span><span class="params">(post: Post)</span> &#123; ... &#125;

fun <span class="title function_">postItem</span><span class="params">(item: Item)</span> &#123;
  requestToken()
    .thenCompose &#123; token -&gt; createPost(token, item) &#125;
    .thenAccept &#123; post -&gt; processPost(post) &#125;
&#125;</code></pre>

<h5 id="Rx-Extension"><a href="#Rx-Extension" class="headerlink" title="Rx Extension"></a>Rx Extension</h5><p>I believe there must be many developers who use this library.</p>
<pre><code class="highlight kotlin">Single.fromCallable &#123; requestToken() &#125;
  .map &#123; token -&gt; createPost(token, item) &#125;
  .subscribe(
    &#123; post -&gt; processPost(post) &#125;,
    &#123; e -&gt; e.printStackTrace() &#125;
  )</code></pre>

<p>I think the biggest problem for me when using Rx is that the exception log is pretty hard to read. And it also creates too many instances that Rx needs and consumes too much memory.</p>
<p>Here’s why Coroutines show and want to give developers another solution.</p>
<h5 id="Coroutines"><a href="#Coroutines" class="headerlink" title="Coroutines"></a>Coroutines</h5><pre><code class="highlight kotlin"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">requestToken</span><span class="params">()</span></span>: Token &#123; ... &#125;
<span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">createPost</span><span class="params">(token: <span class="type">Token</span>, item: <span class="type">Item</span>)</span></span>: Post &#123; ... &#125;
<span class="function"><span class="keyword">fun</span> <span class="title">processPost</span><span class="params">(post: <span class="type">Post</span>)</span></span> &#123; ... &#125;

<span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">postItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;
  GlobalScope.launch &#123;
    <span class="keyword">val</span> token = requestToken()
    <span class="keyword">val</span> post = createPost(token, item)
    processPost(post)
  &#125;
&#125;</code></pre>

<p>It looks just like the previous code snap, doesn’t it? If we want to add a <code>try-catch</code> block inside the <code>postItem</code> function. Just add it. We don’t need any extra effort to handle it.</p>
<p>First of all, let’s check how a coroutine works. A <code>Coroutine</code> is like a <code>Thread</code> in concept. But it’s much more lightweight than a real <code>Thread.</code> Several different coroutines can run on a <code>Thread,</code> and the Coroutine runtime manages them. You might remember the thread itself is not that cheap as you think because the system controls the threads, and it needs to do context-switch for you. </p>
<p>Another reason that a thread is costly is because it would spend more resource on the creation and termination. So the good practice is to use a thread pool (to create some threads inside first) in advance. Let’s back to <code>Coroutines.</code> The <code>Coroutines</code> don’t have the same problem. It’s very lightweight, which means you can create a Coroutine anytime, anywhere. It’s controlled by Kotlin runtime, not by system.</p>
<p>What’s the <code>Suspend</code> keyword? You would call suspending functions in the coroutines, just like regular functions. To call a suspending function, you need to declare the caller function as a suspending function as well. A suspending function can only be used in a coroutine or another suspending function.</p>
<p>When you try to launch a coroutine, it would be like this:</p>
<pre><code class="highlight kotlin">GlobalScope.launch &#123;
  processPost(post)
&#125;</code></pre>

<p>Check the launch function itself:</p>
<pre><code class="highlight kotlin"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">launch</span><span class="params">(</span></span>
<span class="params"><span class="function">  context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span>
<span class="params"><span class="function">  start: <span class="type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span>
<span class="params"><span class="function">  block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.() -&gt; <span class="type">Unit</span></span></span>
<span class="params"><span class="function">)</span></span>: Job</code></pre>

<p>It launches a new coroutine without blocking the current thread and returns a reference to the coroutine as a <code>Job.</code> You can use this <code>Job</code> object to cancel the coroutine execution by calling <code>Job.cancel().</code> A CoroutineScope defines a scope for new coroutines. It contains a <code>CoroutineContext</code> variable, which describes what factors would be involved in the CoroutineScope by setting up the <code>Element.</code></p>
<p>Which thread would host a specific coroutine? In launch function, if you don’t assign a dispatcher, it would use <code>Dispatchers. Default</code>.</p>
<pre><code class="highlight kotlin"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">launch</span><span class="params">(</span></span>
<span class="params"><span class="function">  context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span>
<span class="params"><span class="function">  start: <span class="type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span>
<span class="params"><span class="function">  block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.() -&gt; <span class="type">Unit</span></span></span>
<span class="params"><span class="function">)</span></span>: Job &#123;
  <span class="keyword">val</span> newContext = newCoroutineContext(context)
  <span class="keyword">val</span> coroutine = <span class="keyword">if</span> (start.isLazy)
  LazyStandaloneCoroutine(newContext, block) <span class="keyword">else</span>
  StandaloneCoroutine(newContext, active = <span class="literal">true</span>)
  coroutine.start(start, coroutine, block)
  <span class="keyword">return</span> coroutine
&#125;</code></pre>

<p>in <code>newCoroutineContext</code>, it will use <code>Dispatchers.Default</code> to find a thread to host a coroutine. There are several Dispatchers types:</p>
<pre><code class="highlight kotlin"><span class="keyword">public</span> <span class="keyword">actual</span> <span class="keyword">val</span> Default: CoroutineDispatcher
<span class="keyword">public</span> <span class="keyword">actual</span> <span class="keyword">val</span> Main: MainCoroutineDispatcher
<span class="keyword">public</span> <span class="keyword">actual</span> <span class="keyword">val</span> Unconfined: CoroutineDispatcher
<span class="keyword">public</span> <span class="keyword">val</span> IO: CoroutineDispatcher</code></pre>

<p>In the launch function, if the context does not have any dispatcher nor any other <code>ContinuationInterceptor,</code> then <code>Dispatchers. Default</code> would be used. The <code>Default</code> is a <code>CoroutineDispatcher,</code> which has a shared thread pool to use.</p>
<p>What’s a <code>Job</code>? The most basic instances of <code>Job</code> are created with <code>launch</code> function of coroutine builder or with a <code>Job()</code> factory function. By default, a failure of any of the job’s children leads to an immediate failure of its parent and cancellation of the rest of its children. This behavior can be customized using <code>SupervisorJob</code>. Job has a simple life-cycle:</p>
<table>
<thead>
<tr>
<th>State</th>
<th>isActive</th>
<th>isCompleted</th>
<th>isCancelled</th>
</tr>
</thead>
<tbody><tr>
<td><em>New</em> (optional initial state)</td>
<td><code>false</code></td>
<td><code>false</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><em>Active</em> (default initial state)</td>
<td><code>true</code></td>
<td><code>false</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><em>Completing</em> (transient state)</td>
<td><code>true</code></td>
<td><code>false</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><em>Cancelling</em> (transient state)</td>
<td><code>false</code></td>
<td><code>false</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><em>Cancelled</em> (final state)</td>
<td><code>false</code></td>
<td><code>true</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><em>Completed</em> (final state)</td>
<td><code>false</code></td>
<td><code>true</code></td>
<td><code>false</code></td>
</tr>
</tbody></table>
<p>It has three different states: <code>isActive,</code> <code>isCompleted,</code> and <code>isCancelled.</code> Conceptually, execution of the job does not produce a result value. Jobs are launched solely for their side-effects. If you try to get a result from a <code>Job,</code> check the <code>Deferred.</code></p>
<p>Here I introduce the basic concepts of Coroutines, which is very powerful and helps to reduce the complexity of multi-task in Kotlin world.</p>
<p>Happy coding, enjoy.</p>
<h4 id="Part2-Suspend-Resume-and-Dispatch"><a href="#Part2-Suspend-Resume-and-Dispatch" class="headerlink" title="Part2 - Suspend, Resume and Dispatch"></a>Part2 - Suspend, Resume and Dispatch</h4><h4 id="Part3-Callback-Interaction-and-Cancellation"><a href="#Part3-Callback-Interaction-and-Cancellation" class="headerlink" title="Part3 - Callback, Interaction and Cancellation"></a>Part3 - Callback, Interaction and Cancellation</h4><h4 id="Part4-Exception"><a href="#Part4-Exception" class="headerlink" title="Part4 - Exception"></a>Part4 - Exception</h4><h4 id="Part5-Concurrency"><a href="#Part5-Concurrency" class="headerlink" title="Part5 - Concurrency"></a>Part5 - Concurrency</h4><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ol>
<li>KotlinConf 2017 - Introduction to Coroutines by Roman Elizarov</li>
<li>Asynchronous Programming Techniques</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Coroutines/" rel="tag"># Coroutines</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/27/Android-Thread-Model/" rel="prev" title="Android Thread Model">
      <i class="fa fa-chevron-left"></i> Android Thread Model
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/01/Dagger-Series-Something-amazing-about-constructor-injection/" rel="next" title="Dagger Series: Something amazing about constructor injection">
      Dagger Series: Something amazing about constructor injection <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/27/Android-Coroutines-Introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chauyan">
      <meta itemprop="description" content="Personal dev blog for sharing what I've learned.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="舊金山周記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android Coroutines - Introduction
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-27 17:51:42" itemprop="dateCreated datePublished" datetime="2019-12-27T17:51:42-08:00">2019-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-12 00:44:37" itemprop="dateModified" datetime="2020-04-12T00:44:37-07:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-Dev/" itemprop="url" rel="index"><span itemprop="name">Android Dev</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/12/27/Android-Coroutines-Introduction/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/12/27/Android-Coroutines-Introduction/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="https://chauyanw.files.wordpress.com/2019/08/kotlin-coroutines-1.png?w=2924" alt="kotlin-coroutines-1.png?w=2924"></p>
<p>I recently read the source code of <code>Coroutines.</code> It’s pretty fun, and I’ve learned a lot from the source code. I am going to share some I learned here. I would break the learning into several parts. I hope everyone can find something useful for your projects.</p>
<span id="more"></span>

<p>I download the latest master branch code at <a href="https://github.com/Kotlin/kotlinx.coroutines"><strong>HERE</strong></a>, and if you are interested, you can just download the official release version to try. So, it’s up to you to choose either the official release version or the latest master branch. And the Kotlin version is <code>1.3.61</code> check <a href="https://github.com/Kotlin/kotlinx.coroutines/blob/master/README.md">README</a> here.</p>
<h4 id="Part1-Introduction"><a href="#Part1-Introduction" class="headerlink" title="Part1 - Introduction"></a>Part1 - Introduction</h4><p>Before starting the introduction, let’s think of a question: how do you handle the CPU-consuming tasks or networking accessing works? We can’t do these tasks in the main thread (in Android, which is UIThread). Then we need to think about using the multiple threading techniques to solve our questions. In Java, you can use <code>Thread</code> to do this.</p>
<pre><code class="highlight java"><span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;
  <span class="type">String</span> <span class="variable">threadName</span> <span class="operator">=</span> Thread.currentThread().getName();
  System.out.println(<span class="string">&quot;Hello &quot;</span> + threadName);
&#125;;

<span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);
thread.start();

System.out.println(<span class="string">&quot;Done!&quot;</span>);</code></pre>

<p>You can see the result:</p>
<pre><code class="highlight bash">Hello Thread-0
Done!</code></pre>

<p>or</p>
<pre><code class="highlight bash">Done!
Hello Thread-0</code></pre>

<p>But creating threads frequently is a resource-consuming behavior, you would want to create a <code>ThreadPool</code> to reduce the cost.</p>
<p>In Android, we have several options for concurrency tasks. For example, you can use the <code>AsyncTask,</code> <code>Background Service,</code> and <code>Handler</code> in the Android projects.</p>
<p>The second question is: how do you communicate between two different threads? In Java, you need to manipulate the <code>Thread</code> interaction by using <code>IPC</code> mechanism, for example, shared memory, Pipe, named Pipe, mapped memory, semaphore, socket, message, and signals. There are many techniques we can use. What about concurrency in Kotlin’s world? Do we have any weapons for arming? Fortunately, we can still use the same techniques from the Java world. But Kotlin gives us a more powerful weapon, Coroutines, to use.</p>
<p>Let’s see an example first. We have three functions which need the results from the previous one finished the job.</p>
<pre><code class="highlight kotlin"><span class="function"><span class="keyword">fun</span> <span class="title">requestToken</span><span class="params">()</span></span>: Token &#123; ... &#125;
<span class="function"><span class="keyword">fun</span> <span class="title">createPost</span><span class="params">(token: <span class="type">Token</span>, item: <span class="type">Item</span>)</span></span>: Post &#123; ... &#125;
<span class="function"><span class="keyword">fun</span> <span class="title">processPost</span><span class="params">(post: <span class="type">Post</span>)</span></span> &#123; ... &#125;

<span class="comment">// post a specific item</span>
<span class="function"><span class="keyword">fun</span> <span class="title">postItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;
  <span class="keyword">val</span> token = requestToken()
  <span class="keyword">val</span> post = createPost(token, item)
  processPost(post)
&#125;</code></pre>

<p>These three functions are probably time-consuming tasks. Hence, it’s not able to put them in the UI thread in the Android project. What can we do now?</p>
<h5 id="By-using-a-Thread"><a href="#By-using-a-Thread" class="headerlink" title="By using a Thread"></a>By using a Thread</h5><p>As I mentioned before, create a thread to run it.</p>
<pre><code class="highlight kotlin">Thread(&#123;
  postItem(item)
&#125;).start()</code></pre>

<p>Keeping this in mind: thread is not cheap. You would need to do context-switch, which is costly.</p>
<h5 id="By-using-a-Callback"><a href="#By-using-a-Callback" class="headerlink" title="By using a Callback"></a>By using a Callback</h5><p>We can also use a callback function plus threading to catch the result from each function.</p>
<pre><code class="highlight kotlin"><span class="function"><span class="keyword">fun</span> <span class="title">postItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;
  preparePostAsync &#123; token -&gt;
    submitPostAsync(token, item) &#123; post -&gt;
      processPost(post)
    &#125;
  &#125;
&#125;

<span class="function"><span class="keyword">fun</span> <span class="title">preparePostAsync</span><span class="params">(callback: (<span class="type">Token</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;
  <span class="comment">// make request and return immediately</span>
  <span class="comment">// arrange callback to be invoked later</span>
&#125;</code></pre>

<p>What’s the drawback of using callback? The most known pitfall is the <code>callback hell.</code> That makes you hardly debug and read the source code.</p>
<h5 id="By-using-Java-Future"><a href="#By-using-Java-Future" class="headerlink" title="By using Java Future"></a>By using Java <code>Future</code></h5><p>In Java 8, it introduces the <code>CompletableFuture.</code> This feature lets you connect several tasks.</p>
<pre><code class="highlight java">fun <span class="title function_">requestToken</span><span class="params">()</span>: CompletableFuture &#123; ... &#125;
fun <span class="title function_">createPost</span><span class="params">(token: Token, item: Item)</span>: CompletableFuture &#123; ... &#125;
fun <span class="title function_">processPost</span><span class="params">(post: Post)</span> &#123; ... &#125;

fun <span class="title function_">postItem</span><span class="params">(item: Item)</span> &#123;
  requestToken()
    .thenCompose &#123; token -&gt; createPost(token, item) &#125;
    .thenAccept &#123; post -&gt; processPost(post) &#125;
&#125;</code></pre>

<h5 id="Rx-Extension"><a href="#Rx-Extension" class="headerlink" title="Rx Extension"></a>Rx Extension</h5><p>I believe there must be many developers who use this library.</p>
<pre><code class="highlight kotlin">Single.fromCallable &#123; requestToken() &#125;
  .map &#123; token -&gt; createPost(token, item) &#125;
  .subscribe(
    &#123; post -&gt; processPost(post) &#125;,
    &#123; e -&gt; e.printStackTrace() &#125;
  )</code></pre>

<p>I think the biggest problem for me when using Rx is that the exception log is pretty hard to read. And it also creates too many instances that Rx needs and consumes too much memory.</p>
<p>Here’s why Coroutines show and want to give developers another solution.</p>
<h5 id="Coroutines"><a href="#Coroutines" class="headerlink" title="Coroutines"></a>Coroutines</h5><pre><code class="highlight kotlin"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">requestToken</span><span class="params">()</span></span>: Token &#123; ... &#125;
<span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">createPost</span><span class="params">(token: <span class="type">Token</span>, item: <span class="type">Item</span>)</span></span>: Post &#123; ... &#125;
<span class="function"><span class="keyword">fun</span> <span class="title">processPost</span><span class="params">(post: <span class="type">Post</span>)</span></span> &#123; ... &#125;

<span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">postItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;
  GlobalScope.launch &#123;
    <span class="keyword">val</span> token = requestToken()
    <span class="keyword">val</span> post = createPost(token, item)
    processPost(post)
  &#125;
&#125;</code></pre>

<p>It looks just like the previous code snap, doesn’t it? If we want to add a <code>try-catch</code> block inside the <code>postItem</code> function. Just add it. We don’t need any extra effort to handle it.</p>
<p>First of all, let’s check how a coroutine works. A <code>Coroutine</code> is like a <code>Thread</code> in concept. But it’s much more lightweight than a real <code>Thread.</code> Several different coroutines can run on a <code>Thread,</code> and the Coroutine runtime manages them. You might remember the thread itself is not that cheap as you think because the system controls the threads, and it needs to do context-switch for you. </p>
<p>Another reason that a thread is costly is because it would spend more resource on the creation and termination. So the good practice is to use a thread pool (to create some threads inside first) in advance. Let’s back to <code>Coroutines.</code> The <code>Coroutines</code> don’t have the same problem. It’s very lightweight, which means you can create a Coroutine anytime, anywhere. It’s controlled by Kotlin runtime, not by system.</p>
<p>What’s the <code>Suspend</code> keyword? You would call suspending functions in the coroutines, just like regular functions. To call a suspending function, you need to declare the caller function as a suspending function as well. A suspending function can only be used in a coroutine or another suspending function.</p>
<p>When you try to launch a coroutine, it would be like this:</p>
<pre><code class="highlight kotlin">GlobalScope.launch &#123;
  processPost(post)
&#125;</code></pre>

<p>Check the launch function itself:</p>
<pre><code class="highlight kotlin"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">launch</span><span class="params">(</span></span>
<span class="params"><span class="function">  context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span>
<span class="params"><span class="function">  start: <span class="type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span>
<span class="params"><span class="function">  block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.() -&gt; <span class="type">Unit</span></span></span>
<span class="params"><span class="function">)</span></span>: Job</code></pre>

<p>It launches a new coroutine without blocking the current thread and returns a reference to the coroutine as a <code>Job.</code> You can use this <code>Job</code> object to cancel the coroutine execution by calling <code>Job.cancel().</code> A CoroutineScope defines a scope for new coroutines. It contains a <code>CoroutineContext</code> variable, which describes what factors would be involved in the CoroutineScope by setting up the <code>Element.</code></p>
<p>Which thread would host a specific coroutine? In launch function, if you don’t assign a dispatcher, it would use <code>Dispatchers. Default</code>.</p>
<pre><code class="highlight kotlin"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">launch</span><span class="params">(</span></span>
<span class="params"><span class="function">  context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span>
<span class="params"><span class="function">  start: <span class="type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span>
<span class="params"><span class="function">  block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.() -&gt; <span class="type">Unit</span></span></span>
<span class="params"><span class="function">)</span></span>: Job &#123;
  <span class="keyword">val</span> newContext = newCoroutineContext(context)
  <span class="keyword">val</span> coroutine = <span class="keyword">if</span> (start.isLazy)
  LazyStandaloneCoroutine(newContext, block) <span class="keyword">else</span>
  StandaloneCoroutine(newContext, active = <span class="literal">true</span>)
  coroutine.start(start, coroutine, block)
  <span class="keyword">return</span> coroutine
&#125;</code></pre>

<p>in <code>newCoroutineContext</code>, it will use <code>Dispatchers.Default</code> to find a thread to host a coroutine. There are several Dispatchers types:</p>
<pre><code class="highlight kotlin"><span class="keyword">public</span> <span class="keyword">actual</span> <span class="keyword">val</span> Default: CoroutineDispatcher
<span class="keyword">public</span> <span class="keyword">actual</span> <span class="keyword">val</span> Main: MainCoroutineDispatcher
<span class="keyword">public</span> <span class="keyword">actual</span> <span class="keyword">val</span> Unconfined: CoroutineDispatcher
<span class="keyword">public</span> <span class="keyword">val</span> IO: CoroutineDispatcher</code></pre>

<p>In the launch function, if the context does not have any dispatcher nor any other <code>ContinuationInterceptor,</code> then <code>Dispatchers. Default</code> would be used. The <code>Default</code> is a <code>CoroutineDispatcher,</code> which has a shared thread pool to use.</p>
<p>What’s a <code>Job</code>? The most basic instances of <code>Job</code> are created with <code>launch</code> function of coroutine builder or with a <code>Job()</code> factory function. By default, a failure of any of the job’s children leads to an immediate failure of its parent and cancellation of the rest of its children. This behavior can be customized using <code>SupervisorJob</code>. Job has a simple life-cycle:</p>
<table>
<thead>
<tr>
<th>State</th>
<th>isActive</th>
<th>isCompleted</th>
<th>isCancelled</th>
</tr>
</thead>
<tbody><tr>
<td><em>New</em> (optional initial state)</td>
<td><code>false</code></td>
<td><code>false</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><em>Active</em> (default initial state)</td>
<td><code>true</code></td>
<td><code>false</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><em>Completing</em> (transient state)</td>
<td><code>true</code></td>
<td><code>false</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><em>Cancelling</em> (transient state)</td>
<td><code>false</code></td>
<td><code>false</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><em>Cancelled</em> (final state)</td>
<td><code>false</code></td>
<td><code>true</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><em>Completed</em> (final state)</td>
<td><code>false</code></td>
<td><code>true</code></td>
<td><code>false</code></td>
</tr>
</tbody></table>
<p>It has three different states: <code>isActive,</code> <code>isCompleted,</code> and <code>isCancelled.</code> Conceptually, execution of the job does not produce a result value. Jobs are launched solely for their side-effects. If you try to get a result from a <code>Job,</code> check the <code>Deferred.</code></p>
<p>Here I introduce the basic concepts of Coroutines, which is very powerful and helps to reduce the complexity of multi-task in Kotlin world.</p>
<p>Happy coding, enjoy.</p>
<h4 id="Part2-Suspend-Resume-and-Dispatch"><a href="#Part2-Suspend-Resume-and-Dispatch" class="headerlink" title="Part2 - Suspend, Resume and Dispatch"></a>Part2 - Suspend, Resume and Dispatch</h4><h4 id="Part3-Callback-Interaction-and-Cancellation"><a href="#Part3-Callback-Interaction-and-Cancellation" class="headerlink" title="Part3 - Callback, Interaction and Cancellation"></a>Part3 - Callback, Interaction and Cancellation</h4><h4 id="Part4-Exception"><a href="#Part4-Exception" class="headerlink" title="Part4 - Exception"></a>Part4 - Exception</h4><h4 id="Part5-Concurrency"><a href="#Part5-Concurrency" class="headerlink" title="Part5 - Concurrency"></a>Part5 - Concurrency</h4><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ol>
<li>KotlinConf 2017 - Introduction to Coroutines by Roman Elizarov</li>
<li>Asynchronous Programming Techniques</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Coroutines/" rel="tag"># Coroutines</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/27/Android-Thread-Model/" rel="prev" title="Android Thread Model">
      <i class="fa fa-chevron-left"></i> Android Thread Model
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/01/Dagger-Series-Something-amazing-about-constructor-injection/" rel="next" title="Dagger Series: Something amazing about constructor injection">
      Dagger Series: Something amazing about constructor injection <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>
  <div>
  <script type="text/javascript">
	atOptions = {
		'key' : '335b6d5fd0ce419dba15708955862700',
		'format' : 'iframe',
		'height' : 60,
		'width' : 468,
		'params' : {}
	};
	document.write('<scr' + 'ipt type="text/javascript" src="http' + (location.protocol === 'https:' ? 's' : '') + '://www.madcpms.com/335b6d5fd0ce419dba15708955862700/invoke.js"></scr' + 'ipt>');
</script>
  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Part1-Introduction"><span class="nav-number">1.</span> <span class="nav-text">Part1 - Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#By-using-a-Thread"><span class="nav-number">1.1.</span> <span class="nav-text">By using a Thread</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#By-using-a-Callback"><span class="nav-number">1.2.</span> <span class="nav-text">By using a Callback</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#By-using-Java-Future"><span class="nav-number">1.3.</span> <span class="nav-text">By using Java Future</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Rx-Extension"><span class="nav-number">1.4.</span> <span class="nav-text">Rx Extension</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Coroutines"><span class="nav-number">1.5.</span> <span class="nav-text">Coroutines</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part2-Suspend-Resume-and-Dispatch"><span class="nav-number">2.</span> <span class="nav-text">Part2 - Suspend, Resume and Dispatch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part3-Callback-Interaction-and-Cancellation"><span class="nav-number">3.</span> <span class="nav-text">Part3 - Callback, Interaction and Cancellation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part4-Exception"><span class="nav-number">4.</span> <span class="nav-text">Part4 - Exception</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part5-Concurrency"><span class="nav-number">5.</span> <span class="nav-text">Part5 - Concurrency</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reference"><span class="nav-number">6.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chauyan</p>
  <div class="site-description" itemprop="description">Personal dev blog for sharing what I've learned.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangchauyan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangchauyan" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wang.chauyan@gmail.com" title="E-Mail → mailto:wang.chauyan@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/deathrid" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;deathrid" rel="noopener" target="_blank"><i class="twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/chauyanw/" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;chauyanw&#x2F;" rel="noopener" target="_blank"><i class="facebook fa-fw"></i>FB Page</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chauyan</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://chauyan.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://yoursite.com/2019/12/27/Android-Coroutines-Introduction/";
    this.page.identifier = "2019/12/27/Android-Coroutines-Introduction/";
    this.page.title = "Android Coroutines - Introduction";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://chauyan.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCqTNIS0PZUFVzFmQOCcFEheWocG9daymY",
    authDomain: "personaldevblog.firebaseapp.com",
    databaseURL: "https://personaldevblog.firebaseio.com",
    projectId: "personaldevblog",
    storageBucket: "personaldevblog.appspot.com",
    messagingSenderId: "785621246959",
    appId: "1:785621246959:web:87cab80109fd2701f44c1a",
    measurementId: "G-4KWYT0P8Z8"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>
</body>
</html>
