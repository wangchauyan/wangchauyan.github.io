<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msapplication-config" content="/images/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideRightIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="In the Introduction section, we already have a big picture of the Coroutines feature, including what it is, how we can use it, and other basic concepts. In this article, I will introduce another crit">
<meta name="keywords" content="Coroutines">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Coroutines - Suspend, Resume, and Dispatch">
<meta property="og:url" content="http://yoursite.com/2020/02/04/Android-Coroutines-Suspend-Resume-and-Dispatch/index.html">
<meta property="og:site_name" content="舊金山周記">
<meta property="og:description" content="In the Introduction section, we already have a big picture of the Coroutines feature, including what it is, how we can use it, and other basic concepts. In this article, I will introduce another crit">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://chauyanw.files.wordpress.com/2019/08/kotlin-coroutines-1.png?w=2924">
<meta property="og:updated_time" content="2020-04-12T07:44:44.788Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Coroutines - Suspend, Resume, and Dispatch">
<meta name="twitter:description" content="In the Introduction section, we already have a big picture of the Coroutines feature, including what it is, how we can use it, and other basic concepts. In this article, I will introduce another crit">
<meta name="twitter:image" content="https://chauyanw.files.wordpress.com/2019/08/kotlin-coroutines-1.png?w=2924">

<link rel="canonical" href="http://yoursite.com/2020/02/04/Android-Coroutines-Suspend-Resume-and-Dispatch/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Android Coroutines - Suspend, Resume, and Dispatch | 舊金山周記</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149656006-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-149656006-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">舊金山周記</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">The Venture of San Francisco</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">99</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">61</span></a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/04/Android-Coroutines-Suspend-Resume-and-Dispatch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chauyan">
      <meta itemprop="description" content="Personal dev blog for sharing what I've learned.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="舊金山周記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android Coroutines - Suspend, Resume, and Dispatch
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-04 23:39:29" itemprop="dateCreated datePublished" datetime="2020-02-04T23:39:29-08:00">2020-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-12 00:44:44" itemprop="dateModified" datetime="2020-04-12T00:44:44-07:00">2020-04-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-Dev/" itemprop="url" rel="index">
                    <span itemprop="name">Android Dev</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/02/04/Android-Coroutines-Suspend-Resume-and-Dispatch/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/02/04/Android-Coroutines-Suspend-Resume-and-Dispatch/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="https://chauyanw.files.wordpress.com/2019/08/kotlin-coroutines-1.png?w=2924" alt="kotlin-coroutines-1.png?w=2924"></p>
<p>In the <a href="https://personaldevblog.firebaseapp.com/2019/12/27/Android-Coroutines-Introduction" target="_blank" rel="noopener">Introduction</a> section, we already have a big picture of the <code>Coroutines</code> feature, including what it is, how we can use it, and other basic concepts. In this article, I will introduce another critical keyword <code>suspend</code>:</p>
<a id="more"></a>

<h4 id="What’s-a-suspend-function"><a href="#What’s-a-suspend-function" class="headerlink" title="What’s a suspend function?"></a>What’s a suspend function?</h4><p>Remember the example we use before:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">requestToken</span><span class="params">()</span></span>: Token &#123; ... &#125;</span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">createPost</span><span class="params">(token: <span class="type">Token</span>, item: <span class="type">Item</span>)</span></span>: Post &#123; ... &#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">processPost</span><span class="params">(post: <span class="type">Post</span>)</span></span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">postItem</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">  GlobalScope.launch &#123;</span><br><span class="line">    <span class="keyword">val</span> token = requestToken()</span><br><span class="line">    <span class="keyword">val</span> post = createPost(token, item)</span><br><span class="line">    processPost(post)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can see the keyword <code>suspend</code> in front of a function. What does <code>suspend</code> keyword mean? If you compile the Kotlin code, you can see something like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// declaration: requestToken(kotlin.coroutines.Continuation&lt;? super kotlin.Unit&gt;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="title">requestToken</span><span class="params">(Lkotlin/coroutines/Continuation;)</span>Ljava/lang/Object</span>;</span><br></pre></td></tr></table></figure>

<p>The code snap above is what we decompile into java code.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object requestToken(<span class="meta">@NotNull</span> Continuation $completion) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Unit</span>.INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is a bytecode/compiled-java-code sample for this suspend function - requestToken(). We can find there’s a parameter passed into requestToken(), which is a <code>Continuation.</code> What’s a <code>Continuation</code>?</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Interface representing a continuation after a suspension point that returns a value of type `T`.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@SinceKotlin(<span class="meta-string">"1.3"</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Continuation</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * The context of the coroutine that corresponds to this continuation.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">val</span> context: CoroutineContext</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Resumes the execution of the corresponding coroutine passing a successful or failed [result] as the</span></span><br><span class="line"><span class="comment">  * return value of the last suspension point.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">resumeWith</span><span class="params">(result: <span class="type">Result</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s an interface for resuming the suspended point. Here’s an example when you try to use <code>CoroutineScope.Launch</code>:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GlobalScope.launch &#123;</span><br><span class="line">  <span class="keyword">val</span> token = requestToken()</span><br><span class="line">  <span class="keyword">val</span> post = createPost(token)</span><br><span class="line">  processPost(post)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>it will become something like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title">invokeSuspend</span><span class="params">(@NotNull Object $result)</span> </span>&#123;</span><br><span class="line">  Object var10000;</span><br><span class="line">  label17: &#123;</span><br><span class="line">    Object var5 = IntrinsicsKt.getCOROUTINE_SUSPENDED();</span><br><span class="line">    CoroutineScope $<span class="keyword">this</span>$launch;</span><br><span class="line">    Token token;</span><br><span class="line">    MainActivity var6;</span><br><span class="line">    <span class="keyword">switch</span>(<span class="keyword">this</span>.label) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        ResultKt.throwOnFailure($result);</span><br><span class="line">        $<span class="keyword">this</span>$launch = <span class="keyword">this</span>.p$;</span><br><span class="line">        var6 = MainActivity.<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>.L$<span class="number">0</span> = $<span class="keyword">this</span>$launch;</span><br><span class="line">        <span class="keyword">this</span>.label = <span class="number">1</span>;</span><br><span class="line">        var10000 = var6.requestToken(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (var10000 == var5) &#123;</span><br><span class="line">          <span class="keyword">return</span> var5;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        $<span class="keyword">this</span>$launch = (CoroutineScope)<span class="keyword">this</span>.L$<span class="number">0</span>;</span><br><span class="line">        ResultKt.throwOnFailure($result);</span><br><span class="line">        var10000 = $result;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        token = (Token)<span class="keyword">this</span>.L$<span class="number">1</span>;</span><br><span class="line">        $<span class="keyword">this</span>$launch = (CoroutineScope)<span class="keyword">this</span>.L$<span class="number">0</span>;</span><br><span class="line">        ResultKt.throwOnFailure($result);</span><br><span class="line">        var10000 = $result;</span><br><span class="line">        <span class="keyword">break</span> label17;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"call to 'resume' before 'invoke' with coroutine"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    token = (Token)var10000;</span><br><span class="line">    var6 = MainActivity.<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">this</span>.L$<span class="number">0</span> = $<span class="keyword">this</span>$launch;</span><br><span class="line">    <span class="keyword">this</span>.L$<span class="number">1</span> = token;</span><br><span class="line">    <span class="keyword">this</span>.label = <span class="number">2</span>;</span><br><span class="line">    var10000 = var6.createPost(token, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (var10000 == var5) &#123;</span><br><span class="line">      <span class="keyword">return</span> var5;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Post post = (Post)var10000;</span><br><span class="line">  MainActivity.<span class="keyword">this</span>.processPost(post);</span><br><span class="line">  <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In a Coroutine, it doesn’t use a callback function to return value. Instead, it uses the state machine to control what will respond to the next state. A suspend function will block the Coroutine when it’s in, but it wouldn’t block the thread. When it executes the suspend function, it won’t block the whole thread. The current thread can still do other jobs.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Thread &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> context = newSingleThreadContext(<span class="string">"Test Thread"</span>)</span><br><span class="line">  GlobalScope.launch (context) &#123;</span><br><span class="line">    println(<span class="string">"Start first coroutine."</span>)</span><br><span class="line">    delay(<span class="number">200</span>)</span><br><span class="line">    println(<span class="string">"Resume first coroutine after delay 200ms"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  GlobalScope.launch (context)&#123;</span><br><span class="line">    println(<span class="string">"Start second coroutine."</span>)</span><br><span class="line">    delay(<span class="number">100</span>)</span><br><span class="line">    println(<span class="string">"Resume second coroutine after delay 100ms"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Thread.sleep(<span class="number">500</span>)</span><br><span class="line">&#125;.start()</span><br></pre></td></tr></table></figure>

<p>the result:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-08-17 21:25:22.437 I/System.out: Start first coroutine.</span><br><span class="line">2019-08-17 21:25:22.473 I/System.out: Start second coroutine.</span><br><span class="line">2019-08-17 21:25:22.574 I/System.out: Resume second coroutine after delay 100ms</span><br><span class="line">2019-08-17 21:25:22.656 I/System.out: Resume first coroutine after delay 200ms</span><br></pre></td></tr></table></figure>

<p>That’s why a Coroutine is very lightweight, and you can create it anytime without spending many resources on creating a Coroutine. After this, you might have a question: after resuming the suspended status, current Coroutine will still run on the same thread?</p>
<p>If you remember, I mentioned <code>Dispatcher</code> would decide which thread a Coroutine should run. There are two categories of dispatcher - <code>confined</code> &amp; <code>unconfined.</code> The <code>Default,</code> <code>Main,</code> and <code>IO</code> belong to <code>Confined</code> category, and <code>Unconfined</code> is <code>unconfined.</code> Let’s create two different coroutines and use <code>Confined</code> &amp; <code>Unconfined</code> dispatchers to see what will happen.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Thread &#123;</span><br><span class="line">  GlobalScope.launch (Dispatchers.Main) &#123;</span><br><span class="line">    println(<span class="string">"First coroutine runs in <span class="subst">$&#123;Thread.currentThread().name&#125;</span>"</span>)</span><br><span class="line">    delay(<span class="number">100</span>)</span><br><span class="line">    println(<span class="string">"First coroutine resumes and runs in <span class="subst">$&#123;Thread.currentThread().name&#125;</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  GlobalScope.launch (Dispatchers.Unconfined)&#123;</span><br><span class="line">    println(<span class="string">"Second coroutine runs in <span class="subst">$&#123;Thread.currentThread().name&#125;</span>"</span>)</span><br><span class="line">    delay(<span class="number">100</span>)</span><br><span class="line">    println(<span class="string">"Second coroutine resumes and runs in <span class="subst">$&#123;Thread.currentThread().name&#125;</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  Thread.sleep(<span class="number">500</span>)</span><br><span class="line">&#125;.start()</span><br></pre></td></tr></table></figure>

<p>Result:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-08-17 21:43:22.895 I/System.out: Second coroutine runs in Thread-4</span><br><span class="line">2019-08-17 21:43:22.947 I/System.out: First coroutine runs in main</span><br><span class="line">2019-08-17 21:43:23.005 I/System.out: Second coroutine resumes and runs in kotlinx.coroutines.DefaultExecutor</span><br><span class="line">2019-08-17 21:43:23.050 I/System.out: First coroutine resumes and runs in main</span><br></pre></td></tr></table></figure>

<p>When you use a <code>confined</code> dispatcher, no matter when you suspend the Coroutine, it would still run on the same thread after it resumes for the <code>Dispatchers.Unconfined</code> setting, it would first start on the caller thread but continue on a thread based on where the suspend function is.</p>
<p>So far, I introduce how the suspend function works, but it’s still worth going through how to create a Coroutine, start it and resume mechanism, especially it would be great to know how to switch different Coroutines. Let’s dig in a little bit deeper.</p>
<p>Go back to the <code>CoroutineScope.Launch</code>:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">launch</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span></span><br><span class="line"><span class="function"><span class="params">  start: <span class="type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span></span><br><span class="line"><span class="function"><span class="params">  block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.() -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>: Job &#123;</span><br><span class="line">  <span class="keyword">val</span> newContext = newCoroutineContext(context)</span><br><span class="line">  <span class="keyword">val</span> coroutine = <span class="keyword">if</span> (start.isLazy)</span><br><span class="line">      LazyStandaloneCoroutine(newContext, block) </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      StandaloneCoroutine(newContext, active = <span class="literal">true</span>)</span><br><span class="line">  coroutine.start(start, coroutine, block)</span><br><span class="line">  <span class="keyword">return</span> coroutine</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In general, the <code>start</code> parameter will be <code>CoroutineStart.DEFAULT</code>. It would go to here once the start function calls:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R, T&gt;</span> <span class="params">(<span class="keyword">suspend</span> (R)</span></span> -&gt; T).startCoroutineCancellable(</span><br><span class="line">  receiver: R, </span><br><span class="line">  completion: Continuation</span><br><span class="line">) = runSafely(completion) &#123;</span><br><span class="line">  createCoroutineUnintercepted(</span><br><span class="line">    receiver, completion</span><br><span class="line">  ).intercepted().resumeCancellable(<span class="built_in">Unit</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It eventually calls the function - <code>createCoroutineUnintercepted</code> to create a Coroutine. What does this function do?</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">actual</span> <span class="function"><span class="title">fun</span> <span class="params">(<span class="keyword">suspend</span> ()</span></span> -&gt; T).createCoroutineUnintercepted(</span><br><span class="line">  completion: Continuation</span><br><span class="line">): Continuation &#123;</span><br><span class="line">  <span class="keyword">val</span> probeCompletion = probeCoroutineCreated(completion)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> BaseContinuationImpl)</span><br><span class="line">      create(probeCompletion)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      createCoroutineFromSuspendFunction(probeCompletion) &#123;</span><br><span class="line">        (<span class="keyword">this</span> <span class="keyword">as</span> Function1&lt;Continuation, Any?&gt;).invoke(it)</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It creates a Coroutine, which is not intercepted without a receiver but with a result type <code>T.</code> This function creates a new and fresh instance of suspendable computation every time when it is invoked. To start executing this prepared Coroutine, it would call <code>resume(Unit)</code> on the returned Continuation instance. So, remember <code>createCoroutineUnintercepted</code> that will call <code>resumeCancellable</code> to execute a created Coroutine.</p>
<p><strong>resumeCancellable</strong> function</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> Continuation.<span class="title">resumeCancellable</span><span class="params">(value: <span class="type">T</span>)</span></span> = <span class="keyword">when</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">  <span class="keyword">is</span> DispatchedContinuation -&gt; resumeCancellable(value)</span><br><span class="line">  <span class="keyword">else</span> -&gt; resume(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>resume</strong> function</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> Continuation.<span class="title">resume</span><span class="params">(value: <span class="type">T</span>)</span></span>: <span class="built_in">Unit</span> =</span><br><span class="line">  resumeWith(Result.success(value))</span><br></pre></td></tr></table></figure>

<p>In the resume function, it calls the <code>resumeWith</code> function in a Continuation. Let’s check how it works.</p>
<p><strong>BaseContinuationImpl</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseContinuationImpl</span></span>(</span><br><span class="line">  <span class="comment">// This is `public val` so that it is private on JVM and cannot be modified by untrusted code, yet</span></span><br><span class="line">  <span class="comment">// it has a public getter (since even untrusted code is allowed to inspect its call stack).</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">val</span> completion: Continuation?</span><br><span class="line">) : Continuation, CoroutineStackFrame, Serializable &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This implementation is final. This fact is used to unroll resumeWith recursion.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">resumeWith</span><span class="params">(result: <span class="type">Result</span>)</span></span> &#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> outcome = invokeSuspend(param)</span><br><span class="line">    <span class="keyword">if</span> (outcome === COROUTINE_SUSPENDED) <span class="keyword">return</span></span><br><span class="line">    Result.success(outcome)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (exception: Throwable) &#123;</span><br><span class="line">    Result.failure(exception)</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">invokeSuspend</span><span class="params">(result: <span class="type">Result</span>)</span></span>: Any?</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>BaseContinuationImpl</code> is the implementation of the interface <code>Continuation</code>. You can see when a Coroutine tries to get the outcome, it will call <code>invokeSuspend</code> function which is generated by the compiler. If you still remember the example <code>processPost</code> we listed before, the compiled java code shows that the actual computation is in the <code>invokeSuspend</code> function. So the starting flow is:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resumeCancellable(value: T) -&gt; resume(value) -&gt; resumeWith(Result.success(value)) -&gt; invokeSuspend(param)</span><br></pre></td></tr></table></figure>

<p>What does <code>intercepted()</code> do in the <code>startCoroutineCancellable</code>? Let’s see the implementation:</p>
<p><strong>ContinuationImpl</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ContinuationImpl</span></span>(</span><br><span class="line">  completion: Continuation&lt;Any?&gt;?,</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> _context: CoroutineContext?</span><br><span class="line">) : BaseContinuationImpl(completion) &#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">intercepted</span><span class="params">()</span></span>: Continuation&lt;Any?&gt; = intercepted ?: </span><br><span class="line">  (context[ContinuationInterceptor]?.interceptContinuation(<span class="keyword">this</span>) ?: <span class="keyword">this</span>)</span><br><span class="line">  .also &#123; intercepted = it &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In <code>intercepted()</code>, it tries to call <code>context[ContinuationInterceptor]?.interceptContinuation(this)</code> to get the <code>Continuation</code>, what’s the <code>interceptContinuation()</code>?</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ContinuationInterceptor</span> : <span class="type">CoroutineContext.Element &#123;</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="title">interceptContinuation</span><span class="params">(continuation: <span class="type">Continuation</span>)</span></span>: Continuation</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s been defined in the interface <code>ContinuationInterceptor</code>. You can find:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CoroutineDispatcher</span> :<span class="type"></span></span></span><br><span class="line">  AbstractCoroutineContextElement(ContinuationInterceptor), </span><br><span class="line">  ContinuationInterceptor &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The CoroutineDispatcher implements this interface. Basically, the <code>context[ContinuationInterceptor]</code> is <code>CoroutineDispatcher</code>. When we use <code>interceptContinuation()</code>, it executes the <code>DispatchedContinuation()</code> in the <code>CoroutineDispatcher</code> class. What does the <code>DispatchedContinuation()</code> do?</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatchedContinuation</span></span>(</span><br><span class="line">  <span class="meta">@JvmField</span> <span class="keyword">val</span> dispatcher: CoroutineDispatcher,</span><br><span class="line">  <span class="meta">@JvmField</span> <span class="keyword">val</span> continuation: Continuation</span><br><span class="line">) : DispatchedTask(MODE_ATOMIC_DEFAULT), </span><br><span class="line">    CoroutineStackFrame, </span><br><span class="line">    Continuation <span class="keyword">by</span> continuation &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">resumeWith</span><span class="params">(result: <span class="type">Result</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// check if need to dispatch</span></span><br><span class="line">    <span class="keyword">if</span> (dispatcher.isDispatchNeeded(context)) &#123;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="comment">// start dispatching</span></span><br><span class="line">      dispatcher.dispatch(context, <span class="keyword">this</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// if not, execute the task as part of current event loop</span></span><br><span class="line">      executeUnconfined(state, MODE_ATOMIC_DEFAULT) &#123;</span><br><span class="line">        withCoroutineContext(<span class="keyword">this</span>.context, countOrElement) &#123;</span><br><span class="line">          continuation.resumeWith(result)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Suppress(<span class="meta-string">"NOTHING_TO_INLINE"</span>)</span> <span class="comment">// we need it inline to save us an entry on the stack</span></span><br><span class="line">  <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">resumeCancellable</span><span class="params">(value: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// check if need to dispatch</span></span><br><span class="line">    <span class="keyword">if</span> (dispatcher.isDispatchNeeded(context)) &#123;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="comment">// start dispatching</span></span><br><span class="line">      dispatcher.dispatch(context, <span class="keyword">this</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// if not, execute the task as part of current event loop</span></span><br><span class="line">      executeUnconfined(value, MODE_CANCELLABLE) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!resumeCancelled()) &#123;</span><br><span class="line">          resumeUndispatched(value)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This class intercepts the <code>resumeCancellable</code> and <code>resumeWith</code> functions. And it checks if this Coroutine will need to dispatch.</p>
<p>Alright, so far, we already know how to suspend, resume, and dispatch a Coroutine. It uses different layers to implement different functionalities. For example, <code>BaseContinuationImpl</code> implements the Coroutine resume, <code>DispatchedContinuation</code> implements the dispatching logic. Let’s move on to how to control the <code>Job</code> itself in the next post.</p>
<p>Happy coding, enjoy.</p>
<h4 id="Part1-Introduction"><a href="#Part1-Introduction" class="headerlink" title="Part1 - Introduction"></a>Part1 - <a href="https://personaldevblog.firebaseapp.com/2019/12/27/Android-Coroutines-Introduction" target="_blank" rel="noopener">Introduction</a></h4><h4 id="Part3-Callback-Interaction-and-Cancellation"><a href="#Part3-Callback-Interaction-and-Cancellation" class="headerlink" title="Part3 - Callback, Interaction and Cancellation"></a>Part3 - Callback, Interaction and Cancellation</h4><h4 id="Part4-Exception"><a href="#Part4-Exception" class="headerlink" title="Part4 - Exception"></a>Part4 - Exception</h4><h4 id="Part5-Concurrency"><a href="#Part5-Concurrency" class="headerlink" title="Part5 - Concurrency"></a>Part5 - Concurrency</h4><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ol>
<li><a href="https://www.youtube.com/watch?v=_hfBv0a09Jc" target="_blank" rel="noopener">KotlinConf 2017 - Introduction to Coroutines by Roman Elizarov</a></li>
<li><a href="https://kotlinlang.org/docs/tutorials/coroutines/async-programming.html" target="_blank" rel="noopener">Asynchronous Programming Techniques - Kotlin Programming Language</a></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Coroutines/" rel="tag"># Coroutines</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/01/Dagger-Series-Something-amazing-about-constructor-injection/" rel="prev" title="Dagger Series: Something amazing about constructor injection">
      <i class="fa fa-chevron-left"></i> Dagger Series: Something amazing about constructor injection
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/16/Shelter-in-place-for-COVID-19-in-San-Francisco/" rel="next" title="Shelter in place for COVID-19 in San Francisco">
      Shelter in place for COVID-19 in San Francisco <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>
  <div>
  <script type="text/javascript">
	atOptions = {
		'key' : '335b6d5fd0ce419dba15708955862700',
		'format' : 'iframe',
		'height' : 60,
		'width' : 468,
		'params' : {}
	};
	document.write('<scr' + 'ipt type="text/javascript" src="http' + (location.protocol === 'https:' ? 's' : '') + '://www.madcpms.com/335b6d5fd0ce419dba15708955862700/invoke.js"></scr' + 'ipt>');
</script>
  </div>


          </div>
          
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#What’s-a-suspend-function"><span class="nav-number">1.</span> <span class="nav-text">What’s a suspend function?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part1-Introduction"><span class="nav-number">2.</span> <span class="nav-text">Part1 - Introduction</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part3-Callback-Interaction-and-Cancellation"><span class="nav-number">3.</span> <span class="nav-text">Part3 - Callback, Interaction and Cancellation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part4-Exception"><span class="nav-number">4.</span> <span class="nav-text">Part4 - Exception</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part5-Concurrency"><span class="nav-number">5.</span> <span class="nav-text">Part5 - Concurrency</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reference"><span class="nav-number">6.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chauyan</p>
  <div class="site-description" itemprop="description">Personal dev blog for sharing what I've learned.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">61</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangchauyan" title="GitHub → https://github.com/wangchauyan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wang.chauyan@gmail.com" title="E-Mail → mailto:wang.chauyan@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/deathrid" title="Twitter → https://twitter.com/deathrid" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/chauyanw/" title="FB Page → https://www.facebook.com/chauyanw/" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i>FB Page</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chauyan</span>
</div>

        








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://chauyan.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "http://yoursite.com/2020/02/04/Android-Coroutines-Suspend-Resume-and-Dispatch/",
            identifier: "2020/02/04/Android-Coroutines-Suspend-Resume-and-Dispatch/",
            title: "Android Coroutines - Suspend, Resume, and Dispatch"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://chauyan.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    window.addEventListener('load', loadComments, false);
</script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCqTNIS0PZUFVzFmQOCcFEheWocG9daymY",
    authDomain: "personaldevblog.firebaseapp.com",
    databaseURL: "https://personaldevblog.firebaseio.com",
    projectId: "personaldevblog",
    storageBucket: "personaldevblog.appspot.com",
    messagingSenderId: "785621246959",
    appId: "1:785621246959:web:87cab80109fd2701f44c1a",
    measurementId: "G-4KWYT0P8Z8"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>
</body>
</html>
